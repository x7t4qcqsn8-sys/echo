<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPhone 16 Pro Emulator - Home</title>
    <style>
        :root {
            --iphone-width: 393px;
            --iphone-height: 852px;
            --iphone-radius: 55px;
            --screen-radius: 47px;
            --island-width: 120px;
            --island-height: 36px;
            --island-radius: 16px;
            --ios-font: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
            
            /* Light & Dark Theme Variables */
            --label-green: #628364;
            --c-bg: #f2f2f7;
            --c-card-bg: #ffffff;
            --c-icon-bg: #e9e9eb;
            --c-text-primary: #000000;
            --c-text-secondary: #8a8a8e;
            --c-text-tertiary: #c7c7cc;
            --c-separator: #c6c6c8;
            --c-dock-bg: rgba(255, 255, 255, 0.45);
            --c-status-bar: #000000;
            --c-app-name: #FFFFFF;
            --c-app-name-shadow: 0 1px 2px rgba(0,0,0,0.5);
            --c-badge-bg: rgba(255, 255, 255, 0.25);
            --c-badge-border: rgba(255, 255, 255, 0.3);
            --c-badge-text: #666;
            --c-badge-icon: #000;
            --c-float-label-bg: rgba(255, 255, 255, 0.25);
            --c-float-label-text: #8a8a8e;
            --c-float-label-border: rgba(255,255,255,0.3);
            --c-switch-bg: #e9e9ea;
            --c-switch-bg-active: #34c759;
            --c-switch-knob: #fff;

            /* Âä®ÊÄÅÈÖçÁΩÆÂèòÈáèÈªòËÆ§ÂÄº */
            --badge-font-size: 5px; 
            --badge-scroll-scale: 0.9;
            --badge-blur: 20px;
            --badge-opacity-active: 0.9;
            --badge-opacity-normal: 0.6;
            --icon-scale: 1.05;
            --icon-text-margin: -1px;
            --dock-bg-alpha: 0.45;
            --dock-blur: 25px;
            --avatar-scale: 0.833;
            --middle-offset: 25px;
            --vinyl-scale: 1.155;
            --badge-offset: 20px;

            /* Êñ∞Â¢ûÂèòÈáè */
            --app-name-size: 12px;
            --float-label-scale: 1.1;
            --vinyl-offset-x: -10px;
            --lower-icons-offset-y: -5px;
            --lower-icons-offset-x: 10px;
            --lower-icons-gap-v: 25px;
            --lower-icons-gap-h: 15px;

            /* Icon colors */
            --bg-icon: #F1F3F5;
            --gray-100: #E9ECEF;
            --gray-200: #CED4DA;
            --gray-300: #ADB5BD;
            --gray-500: #6C757D;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: var(--ios-font);
            overflow: hidden;
        }

        .iphone-body {
            width: calc(var(--iphone-width) + 12px);
            height: calc(var(--iphone-height) + 12px);
            background: #ffffff;
            border: 2px solid #d1d1d6;
            border-radius: var(--iphone-radius);
            padding: 6px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1);
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .screen {
            width: var(--iphone-width);
            height: var(--iphone-height);
            background: #FFFFFF;
            border-radius: var(--screen-radius);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .dynamic-island {
            width: var(--island-width);
            height: var(--island-height);
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border-radius: var(--island-radius);
            position: absolute;
            top: 11px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3000;
        }

        .status-bar {
            position: absolute;
            top: 0;
            width: 100%;
            height: 44px;
            padding: 0 28px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding-bottom: 6px;
            font-size: 16px;
            font-weight: 600;
            color: var(--c-status-bar);
            z-index: 2500;
            pointer-events: none;
        }

        .status-right {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .battery-container {
            display: flex;
            align-items: center;
            gap: 1.5px;
        }
        .battery-body {
            width: 24.5px;
            height: 11.5px;
            background: rgba(0,0,0,0.1);
            border: 1px solid var(--c-status-bar);
            border-radius: 4px;
            position: relative;
            padding: 1px;
            display: flex;
        }
        .battery-fill {
            height: 100%;
            width: 54%;
            background: var(--c-status-bar);
            border-radius: 1.5px;
        }
        .battery-body::after {
            content: '';
            position: absolute;
            right: -3.5px;
            width: 2px;
            height: 4px;
            background-color: var(--c-status-bar);
            border-radius: 0 1px 1px 0;
            top: 50%;
            transform: translateY(-50%);
        }

        .full-screen {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
        }

        #home-screen {
            display: none;
            flex-direction: column;
            padding: 44px 20px 0; 
            background-size: cover;
            background-position: center;
            transform-origin: center;
        }

        .desktop {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding-top: 10px;
        }

        .upper-layout {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        /* Â±ûÊÄßÁâå */
        .badge-widget {
            width: 165px;
            height: 105px;
            background: var(--c-badge-bg);
            backdrop-filter: blur(15px);
            background-size: cover;
            background-position: center;
            border: 1px solid var(--c-badge-border);
            border-radius: 5px;
            position: relative;
            padding: 10px;
            display: flex;
            align-items: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.04);
            margin-top: 20px;
            transform: translateY(calc(20% + var(--badge-offset)));
            z-index: 10;
            overflow: hidden;
        }
        
        .badge-text-scroller {
            flex-grow: 1;
            overflow-x: auto;
            overflow-y: hidden;
            height: 64px;
            display: flex;
            align-items: center;
            scrollbar-width: none;
            mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
        }
        .badge-text-scroller::-webkit-scrollbar { display: none; }


        .stitch-wrap {
            position: absolute;
            top: 6px; left: 6px; right: 6px; bottom: 6px;
            border: 1.2px dashed #d0d0d0;
            border-radius: 5px;
            pointer-events: none;
            z-index: 25;
            background: rgba(255, 255, 255, var(--badge-opacity-normal));
            backdrop-filter: blur(var(--badge-blur));
            transition: all 0.3s ease;
        }
        .stitch-wrap.no-blur {
            background: transparent;
            backdrop-filter: none;
        }

        .badge-inner {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            z-index: 26;
            padding-left: 15px;
        }

        .badge-photo {
            width: 54px;
            height: 64px;
            background: #f5f5f7;
            border-radius: 12px;
            overflow: hidden;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            cursor: pointer;
        }
        .badge-photo img { width: 100%; height: 100%; object-fit: cover; }

        .badge-text {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-width: 100%;
            height: 100%;
            cursor: pointer;
            padding: 1px 0;
            transition: transform 0.3s ease;
            transform-origin: center center;
        }
        .badge-text.scrolling {
            justify-content: center;
            align-items: center;
            gap: 5px;
            transform: scale(var(--badge-scroll-scale));
        }
        .badge-text.scrolling .badge-line {
            font-size: 7px !important;
        }
        
        .badge-line {
            display: flex;
            align-items: center;
            gap: 2px;
            color: var(--c-badge-text);
            white-space: nowrap;
            font-size: 5px !important; 
            transition: font-size 0.3s ease;
        }
        .badge-line span {
            font-size: inherit; 
            display: inline-block;
            line-height: 1.2;
        }
        .badge-icon {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
            opacity: 0.8;
            color: var(--c-badge-icon);
        }

        /* Icon Styles */
        .app-icon svg {
            width: 40px;
            height: 40px;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-width: 1.6;
        }
        .stroke-dark { stroke: var(--gray-500); }
        .stroke-medium { stroke: var(--gray-300); }
        .stroke-light { stroke: var(--gray-200); }
        .fill-dark { fill: var(--gray-500); }
        .fill-medium { fill: var(--gray-300); }
        .fill-light { fill: var(--gray-200); }

        .app-grid-2x2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px 15px;
            flex-grow: 1;
            margin-top: 25px;
        }

        .app-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 60px;
        }

        .app-icon {
            width: 60px;
            height: 60px;
            border-radius: 13px;
            background: var(--c-icon-bg) !important;
            margin-bottom: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            transform: scale(var(--icon-scale));
            transition: transform 0.2s;
            opacity: 0.6;
        }
        
        /* VinylÂî±ÁâáÊú∫Ê†∑Âºè */
        .app-icon.vinyl-style {
            background: linear-gradient(145deg, #f0f0f0, #e0e0e0) !important;
            border-radius: 14px;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        .vinyl-inner {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        /* Â§ßÂûãÂî±ÁâáÊú∫ÁªÑ‰ª∂Ê†∑Âºè */
        .vinyl-player-widget {
            width: 135px;
            height: 135px;
            background: linear-gradient(145deg, #f8f8f8, #e8e8e8);
            border-radius: 20px;
            position: relative;
            box-shadow: 
                0 8px 25px rgba(0,0,0,0.1),
                0 2px 8px rgba(0,0,0,0.06),
                inset 0 1px 0 rgba(255,255,255,0.9);
            overflow: hidden;
            margin-top: 0;
            transform: scale(var(--vinyl-scale)) translateX(var(--vinyl-offset-x));
            transform-origin: top right;
        }

        .vinyl-player-widget .vp-record {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #c8c8c8 0%, #a8a8a8 30%, #b8b8b8 50%, #a0a0a0 70%, #c0c0c0 100%);
            box-shadow: 
                0 3px 12px rgba(0,0,0,0.12),
                inset 0 0 20px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: spin-vinyl 8s linear infinite;
        }

        .vinyl-player-widget .vp-record::before {
            content: '';
            position: absolute;
            width: 95px;
            height: 95px;
            border-radius: 50%;
            border: 1px solid rgba(0,0,0,0.04);
        }

        .vinyl-player-widget .vp-record::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: repeating-radial-gradient(
                circle at center,
                transparent 0px,
                transparent 1.5px,
                rgba(0,0,0,0.02) 1.5px,
                rgba(0,0,0,0.02) 3px
            );
        }

        .vinyl-player-widget .vp-label {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
            box-shadow: 
                0 2px 6px rgba(0,0,0,0.08),
                inset 0 -1px 3px rgba(0,0,0,0.04);
            position: relative;
            cursor: pointer;
            overflow: hidden;
        }

        .vinyl-player-widget .vp-label-art {
            font-size: 22px;
            opacity: 1;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
        }

        .vinyl-player-widget .vp-label-art img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .vinyl-player-widget .vp-center-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #fff;
            border: 1.5px solid #ddd;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        .vinyl-player-widget .vp-arm-base {
            position: absolute;
            top: 8px;
            right: 10px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: linear-gradient(145deg, #fff, #eee);
            border: 2px solid #ccc;
            z-index: 20;
            box-shadow: 0 2px 5px rgba(0,0,0,0.12);
        }

        .vinyl-player-widget .vp-arm-base::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #bbb;
        }

        .vinyl-player-widget .vp-arm {
            position: absolute;
            top: 15px;
            right: 16px;
            width: 45px;
            height: 3px;
            background: linear-gradient(180deg, #c0c0c0, #a0a0a0);
            transform: rotate(30deg);
            transform-origin: right center;
            border-radius: 2px;
            z-index: 15;
            box-shadow: 0 2px 3px rgba(0,0,0,0.15);
        }

        .vinyl-player-widget .vp-arm::before {
            content: '';
            position: absolute;
            left: -4px;
            top: 50%;
            transform: translateY(-50%);
            width: 10px;
            height: 5px;
            background: linear-gradient(180deg, #888, #666);
            border-radius: 1.5px;
        }

        .vinyl-player-widget .vp-arm::after {
            content: '';
            position: absolute;
            left: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 3px;
            background: #555;
            border-radius: 1px;
        }

        @keyframes spin-vinyl {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .app-icon .letter {
            font-size: 28px;
            font-weight: 500;
            color: var(--c-text-primary);
        }
        .app-name {
            display: block;
            font-size: var(--app-name-size);
            color: var(--c-app-name);
            margin-top: -7px;
            text-align: center;
            width: 100%;
            text-shadow: var(--c-app-name-shadow);
        }

        .middle-region {
            height: 200px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-top: calc(10px + var(--middle-offset));
            gap: 10px;
        }

        .center-circle-avatar {
            width: 115px;
            height: 115px;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            overflow: hidden;
            background: #fafafa;
            z-index: 5;
            backdrop-filter: blur(10px);
            transform: scale(var(--avatar-scale)) translateY(-50px);
        }
        .center-circle-avatar img { width: 100%; height: 100%; object-fit: cover; }

        .signature-line {
            font-size: 13px;
            color: var(--c-text-secondary);
            cursor: pointer;
            margin-top: -50px;
        }

        .float-label {
            position: absolute;
            background: var(--c-float-label-bg);
            backdrop-filter: blur(12px);
            padding: 4px 14px;
            border-radius: 15px;
            font-size: 10px;
            color: var(--c-float-label-text);
            white-space: nowrap;
            z-index: 20;
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            font-family: serif;
            border: 0.5px solid var(--c-float-label-border);
            cursor: pointer;
            transform: scale(var(--float-label-scale)) translateY(10px);
        }
        .pos-aeri { top: 5px; left: 45px; }
        .pos-green { top: 10px; right: 40px; }
        .pos-dream { bottom: 100px; left: 40px; }
        .pos-bling { bottom: 95px; right: 35px; }

        .lower-layout {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 5px;
        }

        .lower-combined-layout {
            display: flex;
            gap: 15px;
            margin-top: 0px; 
            align-items: flex-start;
            justify-content: space-between;
        }

        .lower-left-apps {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--lower-icons-gap-v) var(--lower-icons-gap-h);
            transform: translate(var(--lower-icons-offset-x), var(--lower-icons-offset-y));
        }
        
        .app-grid-2x2 .app-item:nth-child(3),
        .app-grid-2x2 .app-item:nth-child(4) {
            margin-top: -10px;
        }
        .lower-left-apps .app-item:nth-child(1) {
            transform: translateY(5px);
        }
        .lower-left-apps .app-item:nth-child(2) {
            transform: translate(10px, 5px);
        }
        .lower-left-apps .app-item:nth-child(4) {
            transform: translateX(10px);
        }

        .lower-combined-layout .vinyl-player-widget {
            margin-top: 0;
            flex-shrink: 0;
        }

        .dock-container {
            position: absolute;
            bottom: 17px;
            left: 18px;
            right: 18px;
            height: 94px;
            background: var(--c-dock-bg);
            backdrop-filter: blur(var(--dock-blur));
            border-radius: 41px;
            display: flex;
            justify-content: space-evenly;
            align-items: center;
            z-index: 50;
            border: 0.5px solid rgba(255,255,255,0.2);
        }

        .dock-app-icon {
            width: 62px;
            height: 62px;
            background: var(--c-icon-bg) !important;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            font-weight: 500;
            color: var(--c-text-primary);
            opacity: 0.6;
        }

        .dock-app-icon svg {
            width: 36px;
            height: 36px;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-width: 1.8;
        }

        .dock-app-icon.settings-icon {
            background: var(--c-icon-bg) !important;
            color: var(--c-text-primary);
            cursor: pointer;
        }

        .dock-app-icon.settings-icon svg {
            width: 32px;
            height: 32px;
        }

        #lock-screen {
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: opacity 0.6s ease;
            background-size: cover;
            background-position: center;
        }

        .lock-content {
            margin-top: 80px;
            text-align: center;
            display: flex;
            flex-direction: column-reverse;
        }
        .time-text { font-size: 80px; font-weight: 700; color: #000; margin-top: -15px; }
        .date-text { font-size: 20px; font-weight: 500; color: #000; }

        .quick-action {
            position: absolute;
            bottom: 50px;
            width: 50px; height: 50px;
            background: rgba(0,0,0,0.05);
            backdrop-filter: blur(20px);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px;
            color: #fff;
        }
        .quick-action svg { width: 24px; height: 24px; fill: #fff; }
        #flashlight { left: 40px; }
        #camera { right: 40px; }

        #passcode-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.14);
            backdrop-filter: blur(40px);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 180px;
            z-index: 4000;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .screen.passcode-active > .dynamic-island,
        .screen.passcode-active > .status-bar {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        #passcode-overlay .status-bar {
            color: #000;
        }
        #passcode-overlay .status-bar svg {
            stroke: #000;
        }
        .screen.night-mode #passcode-overlay .status-bar {
            color: #f5f5f7;
        }
        .screen.night-mode #passcode-overlay .status-bar svg {
            stroke: #f5f5f7;
        }
        .screen.night-mode #passcode-overlay .battery-body {
            border-color: rgba(255,255,255,0.4);
            background: rgba(255,255,255,0.1);
        }
        .screen.night-mode #passcode-overlay .battery-fill {
            background: #f5f5f7;
        }
        .screen.night-mode #passcode-overlay .battery-body::after {
            background-color: rgba(255,255,255,0.4);
        }


        .dots { display: flex; gap: 20px; margin: 5px 0 20px; }
        .dot { width: 12px; height: 12px; border: 1.5px solid #000; border-radius: 50%; }
        .dot.filled { background: #000; }

        .numpad { display: grid; grid-template-columns: repeat(3, 75px); gap: 20px; margin-top: 40px; }
        .num-btn {
            width: 75px; height: 75px; background: rgba(0,0,0,0.05);
            border-radius: 50%; display: flex; flex-direction: column;
            align-items: center; justify-content: center; cursor: pointer;
            transition: background 0.1s;
        }
        .num-btn:active { background: rgba(0,0,0,0.15); }
        .screen.night-mode .num-btn:active { background: rgba(255,255,255,0.25); }
        .num-btn span { font-size: 39px; }
        .num-btn small { font-size: 10px; margin-top: -5px; }

        .passcode-footer {
            position: absolute; bottom: 60px; width: 100%;
            display: flex; justify-content: space-between; padding: 0 50px;
            font-size: 16px; font-weight: 600;
        }

        .home-bar {
            position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%);
            width: 120px; height: 5px; background: #000; border-radius: 3px; opacity: 0.2;
            pointer-events: none;
        }

        @keyframes shake {
            0%, 100% {transform: translateX(0);}
            25% {transform: translateX(-10px);}
            75% {transform: translateX(10px);}
        }
        .shake { animation: shake 0.3s; }

        #contact-interface {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #f2f2f7;
            z-index: 4500;
            display: none;
            flex-direction: column;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        #contact-interface.active {
            transform: translateY(0);
            display: flex;
        }
        .contact-header {
            padding: 50px 20px 15px;
            background: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 0.5px solid #c6c6c8;
        }
        .contact-title { font-size: 17px; font-weight: 600; color: #000; }
        .contact-close { color: #007aff; font-size: 16px; cursor: pointer; }
        
        .contact-list {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        .contact-placeholder-item {
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .contact-placeholder-avatar {
            width: 40px; height: 40px;
            border-radius: 50%;
            background: #e9e9eb;
            display: flex;align-items: center;justify-content: center;
            color: #8e8e93; font-size: 20px;
        }
        .contact-placeholder-info {
            display: flex; flex-direction: column; gap: 2px;
        }
        .cp-name { font-size: 16px; font-weight: 500; color: #000; }
        .cp-desc { font-size: 12px; color: #8e8e93; }

        .edit-bubble-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 5000;
        }
        .edit-bubble {
            width: 280px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        .edit-bubble h3 { margin-bottom: 15px; font-size: 17px; }
        .edit-bubble input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            outline: none;
            font-size: 14px;
        }
        .edit-btns {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .edit-btns button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            background: #e9e9eb;
        }
        .btn-confirm { color: #007aff; }
        .btn-cancel { color: #ff3b30; }

        /* Night Mode Implementation */
        .screen.night-mode {
            --c-bg: #000000;
            --c-card-bg: #1c1c1e;
            --c-icon-bg: #1c1c1e;
            --c-text-primary: #ffffff;
            --c-text-secondary: #8e8e93;
            --c-text-tertiary: #5a5a5e;
            --c-separator: #38383a;
            --c-dock-bg: rgba(30, 30, 30, 0.75);
            --c-status-bar: #ffffff;
            --c-app-name: #ffffff;
            --c-app-name-shadow: none;
            --c-badge-bg: rgba(30, 30, 30, 0.6);
            --c-badge-border: rgba(255, 255, 255, 0.1);
            --c-badge-text: #98989d;
            --c-badge-icon: #ffffff;
            --c-float-label-bg: rgba(44, 44, 46, 0.6);
            --c-float-label-text: #86c489;
            --c-float-label-border: rgba(255, 255, 255, 0.1);
            --c-switch-bg: #39393d;
        }

        .screen.night-mode {
            background-color: var(--c-bg);
            color: var(--c-text-primary);
        }
        
        .screen.night-mode .dynamic-island {
            background: #000000;
        }
        
        .screen.night-mode #home-screen {
            background: transparent;
        }

        .screen.night-mode .badge-widget {
            backdrop-filter: blur(20px);
        }
        .screen.night-mode .stitch-wrap {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }
        .screen.night-mode .badge-icon {
            opacity: 0.7;
        }

        .screen.night-mode .center-circle-avatar {
            border: 4px solid rgba(255, 255, 255, 0.15);
            background: var(--c-card-bg);
        }
        .screen.night-mode .float-label {
            box-shadow: none;
        }
        
        .screen.night-mode .app-icon.vinyl-style {
            background: linear-gradient(145deg, #2c2c2e, #1c1c1e) !important;
            box-shadow: none;
        }
        .screen.night-mode .dock-container {
            border: 0.5px solid rgba(255,255,255,0.1);
        }
        
        .screen.night-mode .vinyl-player-widget {
            background: linear-gradient(145deg, #2c2c2e, #1c1c1e);
            box-shadow: none;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .screen.night-mode .vinyl-player-widget .vp-record::before {
            border-color: rgba(255,255,255,0.05);
        }
        .screen.night-mode .vinyl-player-widget .vp-arm-base {
            background: linear-gradient(145deg, #48484a, #3a3a3c);
            border-color: #555;
        }
        .screen.night-mode .vinyl-player-widget .vp-arm {
            background: linear-gradient(180deg, #636366, #48484a);
        }
        
        .screen.night-mode #lock-screen {
            background: #000000;
        }
        .screen.night-mode .quick-action {
            background: rgba(255,255,255,0.1);
        }
        .screen.night-mode .home-bar {
            background: #ffffff;
            opacity: 0.3;
        }
        .screen.night-mode #passcode-overlay {
            background: rgba(0, 0, 0, 0.4);
        }
        .screen.night-mode .dot {
            border-color: var(--c-text-primary);
        }
        .screen.night-mode .dot.filled {
            background: var(--c-text-primary);
        }
        .screen.night-mode .num-btn {
            background: rgba(255,255,255,0.1);
            color: var(--c-text-primary);
        }
        
        .screen.night-mode #contact-interface {
            background-color: var(--c-bg);
        }
        .screen.night-mode .contact-header {
            border-bottom: 0.5px solid var(--c-separator);
        }

        /* Contact List & Management Styles */
        .fab-btn {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #000;
            color: #fff;
            border: none;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 100;
            transition: transform 0.2s;
        }
        .fab-btn:active { transform: scale(0.95); }
        .screen.night-mode .fab-btn { background: #fff; color: #000; }

        /* Bottom Sheet Modal */
        .sheet-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(5px);
            z-index: 5000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .sheet-overlay.active { display: block; opacity: 1; }

        .bottom-sheet {
            position: absolute;
            bottom: 0; left: 0; width: 100%;
            background: #fff;
            border-radius: 24px 24px 0 0;
            padding: 24px;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            z-index: 5001;
            box-shadow: 0 -5px 30px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            max-height: 80%;
        }
        .sheet-overlay.active .bottom-sheet { transform: translateY(0); }
        .screen.night-mode .bottom-sheet { background: #1c1c1e; }

        .sheet-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px;
        }
        .sheet-title { font-size: 20px; font-weight: 700; }
        .sheet-close { cursor: pointer; padding: 5px; opacity: 0.6; }

        .form-group { margin-bottom: 16px; }
        .form-label {
            display: block; font-size: 13px; color: #8e8e93;
            margin-bottom: 6px; font-weight: 500;
        }
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            background: #f2f2f7;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            color: #000;
            outline: none;
            font-family: inherit;
        }
        .form-textarea { resize: none; height: 80px; }
        .screen.night-mode .form-input, 
        .screen.night-mode .form-select, 
        .screen.night-mode .form-textarea {
            background: #2c2c2e; color: #fff;
        }

        .btn-primary {
            width: 100%;
            padding: 14px;
            background: #007aff;
            color: #fff;
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            margin-top: 10px;
            cursor: pointer;
        }

        /* Avatar Picker in Form */
        .avatar-picker {
            width: 80px; height: 80px;
            border-radius: 50%;
            background: #f2f2f7;
            margin: 0 auto 20px;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; cursor: pointer;
            border: 2px dashed #c7c7cc;
        }
        .avatar-picker img { width: 100%; height: 100%; object-fit: cover; }
        .screen.night-mode .avatar-picker { background: #2c2c2e; border-color: #48484a; }

        /* Contact List Item Style Override */
        .contact-item {
            background: #fff;
            padding: 12px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .contact-item:active { background: #f2f2f7; }
        .screen.night-mode .contact-item { background: #1c1c1e; }
        .screen.night-mode .contact-item:active { background: #2c2c2e; }

        .contact-avatar {
            width: 48px; height: 48px;
            border-radius: 50%;
            background: #e9e9eb;
            overflow: hidden;
            flex-shrink: 0;
        }
        .contact-avatar img { width: 100%; height: 100%; object-fit: cover; }
        
        .contact-info { flex: 1; min-width: 0; }
        .contact-name { font-size: 16px; font-weight: 600; margin-bottom: 2px; }
        .contact-bio { 
            font-size: 13px; color: #8e8e93; 
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .world-tag {
            font-size: 11px;
            color: #007aff;
            background: rgba(0, 122, 255, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
            margin-top: 2px;
        }

    </style>
</head>
<body>

    <div class="iphone-body">
        <div class="screen">
            <div class="dynamic-island"></div>

            <div class="status-bar">
                <div class="status-left">01:20</div>
                <div class="status-right">
                    <span>5G</span>
                    <svg width="16" height="12" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M5 12.55a11 11 0 0 1 14.08 0"></path>
                        <path d="M1.42 9a16 16 0 0 1 21.16 0"></path>
                        <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>
                        <line x1="12" y1="20" x2="12.01" y2="20"></line>
                    </svg>
                    <div class="battery-container">
                        <div class="battery-body">
                            <div class="battery-fill"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="home-screen" class="full-screen">
                <div class="desktop">
                    <div class="upper-layout">
                        <div class="badge-widget" id="badge-widget">
                            <div class="stitch-wrap"></div>
                            <div class="badge-inner">
                                <div class="badge-photo" onclick="openContactInterface()">
                                    <img id="badge-display" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2NjYyI+PHBhdGggZD0iTTEyIDEyYzIuMjEgMCA0LTEuNzkgNC00cy0xLjc5LTQtNC00LTQgMS43OS00IDQgMS43OSA0IDQgNHptMCAyYy0yLjY3IDAtOCAxLjM0LTggNHYyaDE2di0yYzAtMi42Ni01LjMzLTQtOC00eiIvPjwvc3ZnPg==" alt="">
                                </div>
                                <div class="badge-text-scroller" id="badge-scroller">
                                    <div class="badge-text" onclick="openEditBubble('badge')">
                                        <div class="badge-line">
                                            <svg class="badge-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
            <span class="edit-target">„Öé„Öá‚Ä¶ü§çü©∂</span>
                                        </div>
                                        <div class="badge-line">
                                            <svg class="badge-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
            <span class="edit-target">‚ô°‚Å∫ ö ÌñâÎ≥µ </span>
                                        </div>
                                        <div class="badge-line">
                                            <svg class="badge-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
            <span class="edit-target">…û‚Å∫‚ô°‚ÇäÀö.ìè¥·¶í·¶íìè¥ ‚ÇäÀö</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="app-grid-2x2">
                            <div class="app-item">
                                <div class="app-icon">
                                    <svg viewBox="0 0 24 24">
                                        <rect x="2" y="5" width="20" height="14" rx="4" class="stroke-dark" />
                                        <path d="M10 8.5L15.5 12L10 15.5V8.5Z" class="fill-dark" stroke="none"/>
                                    </svg>
                                </div>
                                <div class="app-name">YouTube</div>
                            </div>
                            <div class="app-item" onclick="navigateWithTransition('instagram.html')" style="cursor: pointer;">
                                <div class="app-icon">
                                    <svg viewBox="0 0 24 24">
                                        <rect x="3" y="3" width="18" height="18" rx="5" ry="5" class="stroke-medium" />
                                        <circle cx="12" cy="12" r="4" class="stroke-dark" stroke-width="2" />
                                        <circle cx="17.5" cy="6.5" r="1.2" class="fill-dark" stroke="none" />
                                    </svg>
                                </div>
                                <div class="app-name">Instagram</div>
                            </div>
                            <div class="app-item">
                                <div class="app-icon">
                                    <svg viewBox="0 0 24 24">
                                        <polyline points="4 7 8 18 12 8 16 18 20 7" class="stroke-medium" stroke-linejoin="round" />
                                    </svg>
                                </div>
                                <div class="app-name">WVS</div>
                            </div>
                            <div class="app-item">
                                <div class="app-icon">
                                    <svg viewBox="0 0 24 24">
                                        <line x1="7" y1="7" x2="17" y2="17" class="stroke-dark" stroke-width="2.2" />
                                        <line x1="17" y1="7" x2="7" y2="17" class="stroke-dark" stroke-width="2.2" />
                                    </svg>
                                </div>
                                <div class="app-name">X</div>
                            </div>
                        </div>
                    </div>

                    <div class="middle-region">
                        <div class="center-circle-avatar" onclick="triggerUpload('main-avatar')">
                            <img id="main-display" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2NjYyI+PHBhdGggZD0iTTEyIDEyYzIuMjEgMCA0LTEuNzkgNC00cy0xLjc5LTQtNC00LTQgMS43OS00IDQgMS43OSA0IDQgNHptMCAyYy0yLjY3IDAtOCAxLjM0LTggNHYyaDE2di0yYzAtMi42Ni01LjMzLTQtOC00eiIvPjwvc3ZnPg==" alt="avatar">
                        </div>
                        <div class="signature-line" onclick="openEditBubble('signature')">‚ô™‚úß‚ô´‚Ä¢*¬®*‚Ä¢.¬∏¬∏‚ô™</div>
                        <div class="float-label pos-aeri" onclick="openEditBubble('float')">
                            <span class="edit-target">u n meÔΩúü§ç</span>
                        </div>
                        <div class="float-label pos-green" onclick="openEditBubble('float')">
                            <span class="edit-target">‚ô°‚Å∫ ö ÌñâÎ≥µ …û‚Å∫‚ô°</span>
                        </div>
                        <div class="float-label pos-bling" onclick="openEditBubble('float')">
                            <span class="edit-target">Ï¢ãÏïÑÌï¥Ïöîüí¨‡æÄ‡Ω≤‡æÄ‡Ω≤</span>
                        </div>
                        <div class="float-label pos-dream" onclick="openEditBubble('float')">
                            <span class="edit-target">i luv u <3‚Ä¶ü©∂</span>
                        </div>
                    </div>

                    <div class="lower-combined-layout">
                        <div class="lower-left-apps">
                            <div class="app-item">
                                <div class="app-icon">
                                    <svg viewBox="0 0 24 24">
                                        <rect x="5" y="4" width="14" height="16" rx="2" class="stroke-medium" />
                                        <path d="M7 3V7 M11 3V7 M15 3V7" class="stroke-dark" />
                                        <path d="M7.5 12C8.5 11 9.5 13 10.5 12" class="stroke-light" />
                                        <path d="M16 18l4-4 2 2-4 4h-2v-2z" fill="#F1F3F5" class="stroke-dark" />
                                    </svg>
                                </div>
                                <div class="app-name">Diary</div>
                            </div>
                            <div class="app-item">
                                <div class="app-icon">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M8 6C5.5 6 3.5 8 3.5 10.5C3.5 14 7 17 11 19" class="stroke-medium" fill="none" />
                                        <path d="M11 6C11.5 6 12 6.1 12.5 6.3" class="stroke-medium" />
                                        <path d="M16 6C18.5 6 20.5 8 20.5 10.5C20.5 14 17 17 13 19" class="stroke-medium" fill="none" />
                                        <path d="M13 6C12.5 6 12 6.1 11.5 6.3" class="stroke-medium" />
                                        <path d="M12 19V19.5" class="stroke-medium" />
                                    </svg>
                                </div>
                                <div class="app-name">Date</div>
                            </div>
                            <div class="app-item" onclick="navigateWithTransition('world.html')" style="cursor: pointer;">
                                <div class="app-icon">
                                    <svg viewBox="0 0 24 24">
                                        <rect x="5" y="4" width="14" height="16" rx="2.5" class="stroke-medium" />
                                        <line x1="10" y1="4" x2="10" y2="20" class="stroke-medium" />
                                        <path d="M5 9 Q 7.5 10 10 9" class="stroke-light" fill="none" />
                                        <path d="M5 12 Q 7.5 13 10 12" class="stroke-light" fill="none" />
                                        <path d="M5 15 Q 7.5 16 10 15" class="stroke-light" fill="none" />
                                        <path d="M7.5 4 V 20" class="stroke-light" />
                                        <rect x="13" y="8" width="3" height="1.5" rx="0.5" class="fill-medium" stroke="none" opacity="0.6" />
                                    </svg>
                                </div>
                                <div class="app-name">World</div>
                            </div>
                            <div class="app-item" onclick="navigateWithTransition('KakaoTalk.html')" style="cursor: pointer;">
                                <div class="app-icon">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M15 5C18.3137 5 21 7.23858 21 10C21 11.9079 20.0916 13.606 18.6833 14.4532L19 17L16.2 16.1C15.8152 16.1654 15.4137 16.2 15 16.2" class="stroke-light" />
                                        <path d="M9 19.8C5.68629 19.8 3 17.5614 3 14.8C3 12.0386 5.68629 9.8 9 9.8C12.3137 9.8 15 12.0386 15 14.8C15 17.5614 12.3137 19.8 9 19.8Z" fill="#F1F3F5" stroke="none"/>
                                        <path d="M9 19.8C5.68629 19.8 3 17.5614 3 14.8C3 12.0386 5.68629 9.8 9 9.8C12.3137 9.8 15 12.0386 15 14.8C15 15.2137 14.9585 15.6152 14.8 16L15.6 18.5L13.1118 18.068C12.0156 19.1411 10.5841 19.8 9 19.8Z" class="stroke-light" />
                                        <circle cx="7" cy="14.8" r="0.8" class="fill-dark" />
                                        <circle cx="9" cy="14.8" r="0.8" class="fill-dark" />
                                        <circle cx="11" cy="14.8" r="0.8" class="fill-dark" />
                                    </svg>
                                </div>
                                <div class="app-name">KakaoTalk</div>
                            </div>
                        </div>
                        <div class="vinyl-player-widget" id="vinyl-player">
                            <div class="vp-record">
                                <div class="vp-label" onclick="triggerUpload('vinyl-cover')">
                                    <div class="vp-label-art" id="vinyl-label-art"></div>
                                    <div class="vp-center-dot"></div>
                                </div>
                            </div>
                            <div class="vp-arm-base"></div>
                            <div class="vp-arm"></div>
                        </div>
                    </div>

                </div>

                <div class="dock-container">
                    <div class="dock-app-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" class="stroke-dark" />
                        </svg>
                    </div>
                    <div class="dock-app-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" class="stroke-medium" />
                            <circle cx="12" cy="7" r="4" class="stroke-dark" />
                        </svg>
                    </div>
                    <div class="dock-app-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" class="stroke-medium" />
                            <line x1="8" y1="9" x2="16" y2="9" class="stroke-light" />
                            <line x1="8" y1="13" x2="13" y2="13" class="stroke-light" />
                        </svg>
                    </div>
                    <div class="dock-app-icon settings-icon" onclick="openSettings()">
                        <svg viewBox="0 0 24 24">
                             <circle cx="12" cy="12" r="3" class="stroke-dark" />
                             <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" class="stroke-medium" stroke-width="1.2" />
                             <circle cx="12" cy="12" r="1.5" class="fill-dark" stroke="none" />
                        </svg>
                    </div>
                </div>

                <!-- ËÅîÁ≥ª‰∫∫ÁïåÈù¢ -->
                <div id="contact-interface">
                    <div class="contact-header">
                        <span class="contact-close" onclick="closeContactInterface()">ÂÖ≥Èó≠</span>
                        <span class="contact-title">ÈÄöËÆØÂΩï</span>
                        <div style="width: 30px;"></div> <!-- Spacer -->
                    </div>
                    <div class="contact-list" id="contact-list-container">
                        <!-- Dynamic Content -->
                    </div>
                    
                    <button class="fab-btn" onclick="openContactModal()">+</button>

                    <!-- Add/Edit Contact Modal -->
                    <div class="sheet-overlay" id="contact-overlay" onclick="closeContactModal()">
                        <div class="bottom-sheet" onclick="event.stopPropagation()">
                            <div class="sheet-header">
                                <div class="sheet-title">Êñ∞Âª∫ËÅîÁ≥ª‰∫∫</div>
                                <div class="sheet-close" onclick="closeContactModal()">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"></path></svg>
                                </div>
                            </div>
                            
                            <div class="avatar-picker" onclick="triggerUpload('contact-avatar')">
                                <img id="contact-form-avatar" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2NjYyI+PHBhdGggZD0iTTEyIDEyYzIuMjEgMCA0LTEuNzkgNC00cy0xLjc5LTQtNC00LTQgMS43OS00IDQgMS43OSA0IDQgNHptMCAyYy0yLjY3IDAtOCAxLjM0LTggNHYyaDE2di0yYzAtMi42Ni01LjMzLTQtOC00eiIvPjwvc3ZnPg==" alt="Avatar">
                            </div>

                            <div class="form-group">
                                <label class="form-label">ÂßìÂêç</label>
                                <input type="text" class="form-input" id="contact-name" placeholder="ËæìÂÖ•ËÅîÁ≥ª‰∫∫ÂßìÂêç">
                            </div>

                            <div class="form-group">
                                <label class="form-label">‰∏™ÊÄßÁ≠æÂêç</label>
                                <input type="text" class="form-input" id="contact-bio" placeholder="ÁÆÄÁü≠ÁöÑÊèèËø∞">
                            </div>

                            <div class="form-group">
                                <label class="form-label">ÂÖ≥ËÅî‰∏ñÁïåËßÇ</label>
                                <select class="form-select" id="contact-world-select">
                                    <option value="">Êó†‰∏ñÁïåËßÇ</option>
                                </select>
                            </div>

                            <button class="btn-primary" onclick="saveContact()">‰øùÂ≠ò</button>
                        </div>
                    </div>
                </div>

                <!-- ÁºñËæëÊ∞îÊ≥° -->
                <div id="edit-bubble-overlay" class="edit-bubble-overlay">
                    <div class="edit-bubble">
                        <h3 id="bubble-title">ÊñáÊ°à</h3>
                        <div id="bubble-inputs"></div>
                        <div class="edit-btns">
                            <button class="btn-cancel" onclick="closeEditBubble()">ÂèñÊ∂à</button>
                            <button class="btn-confirm" onclick="saveEdit()">Á°ÆÂÆö</button>
                        </div>
                    </div>
                </div>

                <input type="file" id="img-input" hidden accept="image/*">
            </div>

            <div id="lock-screen" class="full-screen">
                <div class="lock-content" id="lock-content">
                    <div class="time-text">01:20</div>
                    <div class="date-text">Monday, Jan 12</div>
                </div>
                <div class="quick-action" id="flashlight">
                    <svg viewBox="0 0 24 24"><path d="M6 2h12v6l-2 2v10a2 2 0 0 1-2 2H10a2 2 0 0 1-2-2V10L6 8V2zm2 2v3.17l.59.59 2 2L12 11.17l1.41-1.41 2-2 .59-.59V4H8z"/></svg>
                </div>
                <div class="quick-action" id="camera">
                    <svg viewBox="0 0 24 24"><path d="M20 4h-3.17L15 2H9L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 11.5V13H9v2.5L5.5 12 9 8.5V11h6V8.5l3.5 3.5-3.5 3.5z" fill="none"/><path d="M20 4h-3.17L15 2H9L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V6c0-.55.45-1 1-1h14c.55 0 1 .45 1 1v12c0 .55-.45 1-1 1H5c-.55 0-1-.45-1-1z"/></svg>
                </div>
                <div class="home-bar"></div>
            </div>


            <div id="passcode-overlay">
                <div class="dynamic-island"></div>
                <div class="status-bar">
                    <div class="status-left">01:20</div>
                    <div class="status-right">
                        <span>5G</span>
                        <svg width="16" height="12" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M5 12.55a11 11 0 0 1 14.08 0"></path>
                            <path d="M1.42 9a16 16 0 0 1 21.16 0"></path>
                            <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>
                            <line x1="12" y1="20" x2="12.01" y2="20"></line>
                        </svg>
                        <div class="battery-container">
                            <div class="battery-body">
                                <div class="battery-fill"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="font-size:17px; margin-bottom:20px;">Enter Passcode</div>
                <div class="dots">
                    <div class="dot"></div><div class="dot"></div><div class="dot"></div>
                    <div class="dot"></div><div class="dot"></div><div class="dot"></div>
                </div>
                <div class="numpad">
                    <div class="num-btn" onclick="inputDigit(1)"><span>1</span></div>
                    <div class="num-btn" onclick="inputDigit(2)"><span>2</span><small>ABC</small></div>
                    <div class="num-btn" onclick="inputDigit(3)"><span>3</span><small>DEF</small></div>
                    <div class="num-btn" onclick="inputDigit(4)"><span>4</span><small>GHI</small></div>
                    <div class="num-btn" onclick="inputDigit(5)"><span>5</span><small>JKL</small></div>
                    <div class="num-btn" onclick="inputDigit(6)"><span>6</span><small>MNO</small></div>
                    <div class="num-btn" onclick="inputDigit(7)"><span>7</span><small>PQRS</small></div>
                    <div class="num-btn" onclick="inputDigit(8)"><span>8</span><small>TUV</small></div>
                    <div class="num-btn" onclick="inputDigit(9)"><span>9</span><small>WXYZ</small></div>
                </div>
                <div class="numpad" style="margin-top:20px;">
                    <div></div>
                    <div class="num-btn" onclick="inputDigit(0)"><span>0</span></div>
                    <div class="num-btn" style="display:flex; justify-content:center; align-items:center; font-size:16px; font-weight:600; cursor:pointer;" onclick="deleteDigit()">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.12c.36.53.9.88 1.59.88h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-3.7 13.3a.996.996 0 0 1-1.41 0L14.17 13.59l-2.71 2.71a.996.996 0 1 1-1.41-1.41L12.76 12l-2.71-2.71a.996.996 0 1 1 1.41-1.41L14.17 10.59l2.71-2.71a.996.996 0 1 1 1.41 1.41L15.58 12l2.71 2.71c.39.39.39 1.02 0 1.41z"></path></svg>
                    </div>
                </div>
                <div class="passcode-footer">
                    <div>Emergency</div>
                    <div onclick="deleteDigit()" style="cursor:pointer;">Cancel</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            const CURRENT_VERSION = 'v1.1.0-cleanup';
            const savedVersion = localStorage.getItem('app_version');

            if (savedVersion !== CURRENT_VERSION) {
                console.log(`Version updated to ${CURRENT_VERSION}.`);
                localStorage.setItem('app_version', CURRENT_VERSION);
            }
        })();

        function navigateWithTransition(url) {
            window.location.href = url;
        }

        // Êó∂Èó¥Êó•ÊúüÊõ¥Êñ∞
        function updateTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const timeString = `${hours}:${minutes}`;
            
            document.querySelectorAll('.time-text').forEach(el => el.textContent = timeString);
            document.querySelectorAll('.status-left').forEach(el => el.textContent = timeString);

            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const dateString = `${days[now.getDay()]}, ${months[now.getMonth()]} ${now.getDate()}`;
            
            document.querySelectorAll('.date-text').forEach(el => el.textContent = dateString);
        }
        setInterval(updateTime, 1000);
        updateTime();

        // ÁªëÂÆö‰∏äÂàíËß£ÈîÅ
        const lockScreen = document.getElementById('lock-screen');
        const homeScreen = document.getElementById('home-screen');
        const passcodeOverlay = document.getElementById('passcode-overlay');
        let startY = 0;
        let isDragging = false;
        
        // Ëß¶Êë∏‰∫ã‰ª∂
        lockScreen.addEventListener('touchstart', (e) => {
            if (e.target.closest('.quick-action')) return;
            startY = e.touches[0].clientY;
            isDragging = true;
            lockScreen.style.transition = 'none';
        });

        lockScreen.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            e.preventDefault(); 
            const currentY = e.touches[0].clientY;
            const deltaY = currentY - startY;
            if (deltaY < 0) {
                lockScreen.style.transform = `translateY(${deltaY}px)`;
                lockScreen.style.opacity = `${1 + (deltaY / 500)}`;
            }
        });

        lockScreen.addEventListener('touchend', (e) => {
            if (!isDragging) return;
            isDragging = false;
            lockScreen.style.transition = '';
            const endY = e.changedTouches[0].clientY;
            const deltaY = endY - startY;
            if (deltaY < -80) {
                showPasscode();
                setTimeout(() => {
                    lockScreen.style.transform = ''; 
                    lockScreen.style.opacity = '';
                }, 300);
            } else {
                lockScreen.style.transform = '';
                lockScreen.style.opacity = '';
            }
        });
        
        // Èº†Ê†á‰∫ã‰ª∂ÂÖºÂÆπ
        lockScreen.addEventListener('mousedown', (e) => {
            if (e.target.closest('.quick-action')) return;
            startY = e.clientY;
            isDragging = true;
            lockScreen.style.transition = 'none';
        });
        lockScreen.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
            const currentY = e.clientY;
            const deltaY = currentY - startY;
            if (deltaY < 0) {
                 lockScreen.style.transform = `translateY(${deltaY}px)`;
                 lockScreen.style.opacity = `${1 + (deltaY / 500)}`;
            }
        });
        lockScreen.addEventListener('mouseup', (e) => {
            if(!isDragging) return;
            isDragging = false;
            lockScreen.style.transition = '';
            const endY = e.clientY;
            if (endY - startY < -80) {
                showPasscode();
                setTimeout(() => {
                    lockScreen.style.transform = '';
                    lockScreen.style.opacity = '';
                }, 300);
            } else {
                lockScreen.style.transform = '';
                lockScreen.style.opacity = '';
            }
        });
        lockScreen.addEventListener('mouseleave', () => {
            if(isDragging) {
                isDragging = false;
                lockScreen.style.transition = '';
                lockScreen.style.transform = '';
                lockScreen.style.opacity = '';
            }
        });

        function showPasscode() {
            const screen = document.querySelector('.screen');
            screen.classList.add('passcode-active');
            lockScreen.style.opacity = '0';
            
            setTimeout(() => {
                lockScreen.style.display = 'none';
                passcodeOverlay.style.display = 'flex';
                setTimeout(() => {
                    passcodeOverlay.style.opacity = '1';
                }, 10);
                
                passcode = '';
                updateDots();
            }, 300);
        }

        let passcode = '';
        function updateDots() {
            const dots = document.querySelectorAll('.dot');
            dots.forEach((dot, index) => {
                if (index < passcode.length) dot.classList.add('filled');
                else dot.classList.remove('filled');
            });
        }

        function inputDigit(digit) {
            if (passcode.length < 6) {
                passcode += digit;
                updateDots();
                if (passcode.length === 6) {
                    setTimeout(checkPasscode, 200);
                }
            }
        }

        function deleteDigit() {
            if (passcode.length > 0) {
                passcode = passcode.slice(0, -1);
                updateDots();
            } else {
                const screen = document.querySelector('.screen');
                passcodeOverlay.style.opacity = '0';
                
                setTimeout(() => {
                    passcodeOverlay.style.display = 'none';
                    lockScreen.style.display = 'flex';
                    screen.classList.remove('passcode-active');
                    setTimeout(() => {
                        lockScreen.style.opacity = '1';
                    }, 50);
                }, 300);
            }
        }

        function checkPasscode() {
            if (passcode === '020123') {
                localStorage.setItem('isBrowserUnlocked', 'true');
                unlockPhone();
            } else {
                const dotsContainer = document.querySelector('.dots');
                dotsContainer.classList.add('shake');
                setTimeout(() => {
                    dotsContainer.classList.remove('shake');
                    passcode = '';
                    updateDots();
                }, 500);
            }
        }

        function unlockPhone() {
            const screen = document.querySelector('.screen');
            passcodeOverlay.style.opacity = '0';

            setTimeout(() => {
                passcodeOverlay.style.display = 'none';
                screen.classList.remove('passcode-active');
                
                homeScreen.style.display = 'flex';
                homeScreen.style.opacity = '0';
                homeScreen.style.transform = 'scale(0.95)';

                setTimeout(() => {
                    homeScreen.style.opacity = '1';
                    homeScreen.style.transform = 'scale(1)';
                }, 50);

            }, 300);
        }

        // --- Settings Navigation ---
        function openSettings() {
            navigateWithTransition('ËÆæÁΩÆ.html');
        }

        // --- Contact Interface & Logic ---
        let contacts = [];

        function loadContacts() {
            const stored = localStorage.getItem('contacts_data');
            if (stored) {
                contacts = JSON.parse(stored);
            }
        }

        function saveContactsToStorage() {
            localStorage.setItem('contacts_data', JSON.stringify(contacts));
        }

        function renderContacts() {
            const container = document.getElementById('contact-list-container');
            container.innerHTML = '';

            if (contacts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; margin-top: 50px; color: #8e8e93;">
                        <div style="font-size: 40px; margin-bottom: 10px;">üìá</div>
                        <div>ÊöÇÊó†ËÅîÁ≥ª‰∫∫</div>
                        <div style="font-size: 12px; margin-top: 5px;">ÁÇπÂáªÂè≥‰∏ãËßí + Ê∑ªÂä†</div>
                    </div>
                `;
                return;
            }

            contacts.forEach(contact => {
                const el = document.createElement('div');
                el.className = 'contact-item';
                el.onclick = () => alert(`‰∏é ${contact.name} ÁöÑËÅäÂ§©ÂäüËÉΩÂç≥Â∞ÜÊé®Âá∫`); // ÊöÇÊó∂Âç†‰Ωç
                
                // Ëé∑ÂèñÂÖ≥ËÅîÁöÑ‰∏ñÁïåËßÇÂêçÁß∞
                let worldTag = '';
                if (contact.worldId) {
                    const worlds = JSON.parse(localStorage.getItem('worldbook_data') || '[]');
                    const world = worlds.find(w => w.id == contact.worldId);
                    if (world) {
                        worldTag = `<div class="world-tag">${world.title}</div>`;
                    }
                }

                el.innerHTML = `
                    <div class="contact-avatar">
                        <img src="${contact.avatar || 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2NjYyI+PHBhdGggZD0iTTEyIDEyYzIuMjEgMCA0LTEuNzkgNC00cy0xLjc5LTQtNC00LTQgMS43OS00IDQgMS43OSA0IDQgNHptMCAyYy0yLjY3IDAtOCAxLjM0LTggNHYyaDE2di0yYzAtMi42Ni01LjMzLTQtOC00eiIvPjwvc3ZnPg=='}" alt="${contact.name}">
                    </div>
                    <div class="contact-info">
                        <div class="contact-name">${contact.name}</div>
                        <div class="contact-bio">${contact.bio || 'ÊöÇÊó†‰ªãÁªç'}</div>
                        ${worldTag}
                    </div>
                    <div style="opacity: 0.3;" onclick="event.stopPropagation(); deleteContact(${contact.id})">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"></path></svg>
                    </div>
                `;
                container.appendChild(el);
            });
        }

        function deleteContact(id) {
            if(confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ËÅîÁ≥ª‰∫∫ÂêóÔºü')) {
                contacts = contacts.filter(c => c.id !== id);
                saveContactsToStorage();
                renderContacts();
            }
        }

        function openContactInterface() {
            loadContacts();
            renderContacts();
            const contactInterface = document.getElementById('contact-interface');
            contactInterface.style.display = 'flex';
            setTimeout(() => contactInterface.classList.add('active'), 10);
        }

        function closeContactInterface() {
            const contactInterface = document.getElementById('contact-interface');
            contactInterface.classList.remove('active');
            setTimeout(() => contactInterface.style.display = 'none', 300);
        }

        // --- Contact Modal (Add/Edit) ---
        function openContactModal() {
            // Load Worlds into Select
            const worldSelect = document.getElementById('contact-world-select');
            worldSelect.innerHTML = '<option value="">Êó†‰∏ñÁïåËßÇ</option>';
            
            const worlds = JSON.parse(localStorage.getItem('worldbook_data') || '[]');
            worlds.forEach(w => {
                const opt = document.createElement('option');
                opt.value = w.id;
                opt.textContent = w.title;
                worldSelect.appendChild(opt);
            });

            // Reset Form
            document.getElementById('contact-name').value = '';
            document.getElementById('contact-bio').value = '';
            document.getElementById('contact-world-select').value = '';
            document.getElementById('contact-form-avatar').src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2NjYyI+PHBhdGggZD0iTTEyIDEyYzIuMjEgMCA0LTEuNzkgNC00cy0xLjc5LTQtNC00LTQgMS43OS00IDQgMS43OSA0IDQgNHptMCAyYy0yLjY3IDAtOCAxLjM0LTggNHYyaDE2di0yYzAtMi42Ni01LjMzLTQtOC00eiIvPjwvc3ZnPg==';
            
            // Show
            const overlay = document.getElementById('contact-overlay');
            overlay.classList.add('active');
        }

        function closeContactModal() {
            const overlay = document.getElementById('contact-overlay');
            overlay.classList.remove('active');
        }

        function saveContact() {
            const name = document.getElementById('contact-name').value.trim();
            const bio = document.getElementById('contact-bio').value.trim();
            const worldId = document.getElementById('contact-world-select').value;
            const avatarSrc = document.getElementById('contact-form-avatar').src;

            if (!name) {
                alert('ËØ∑ËæìÂÖ•ËÅîÁ≥ª‰∫∫ÂßìÂêç');
                return;
            }

            const newContact = {
                id: Date.now(),
                name: name,
                bio: bio,
                worldId: worldId,
                avatar: avatarSrc
            };

            contacts.push(newContact);
            saveContactsToStorage();
            renderContacts();
            closeContactModal();
        }

        // --- Edit Bubble Logic ---
        const editBubbleOverlay = document.getElementById('edit-bubble-overlay');
        const bubbleTitle = document.getElementById('bubble-title');
        const bubbleInputs = document.getElementById('bubble-inputs');
        let currentEditType = null;

        function openEditBubble(type) {
            currentEditType = type;
            bubbleInputs.innerHTML = ''; // clear
            editBubbleOverlay.style.display = 'flex';
            
            if (type === 'badge') {
                bubbleTitle.textContent = 'ÁºñËæëÂ±ûÊÄßÁâåÊñáÊ°à';
                const lines = document.querySelectorAll('.badge-text .edit-target');
                lines.forEach((line, index) => {
                    const input = document.createElement('input');
                    input.value = line.textContent;
                    input.placeholder = `Á¨¨ ${index + 1} Ë°åÊñáÊ°à`;
                    input.id = `edit-input-${index}`;
                    bubbleInputs.appendChild(input);
                });
            } else if (type === 'signature') {
                bubbleTitle.textContent = 'ÁºñËæë‰∏™ÊÄßÁ≠æÂêç';
                const input = document.createElement('input');
                input.value = document.querySelector('.signature-line').textContent;
                bubbleInputs.appendChild(input);
            } else if (type === 'float') {
                bubbleTitle.textContent = 'ÁºñËæëÊµÆÂä®Ê†áÁ≠æ';
                const labels = document.querySelectorAll('.float-label .edit-target');
                labels.forEach((label, index) => {
                    const input = document.createElement('input');
                    input.value = label.textContent;
                    input.placeholder = `Ê†áÁ≠æ ${index + 1}`;
                    input.id = `edit-input-float-${index}`;
                    bubbleInputs.appendChild(input);
                });
            }
        }

        function closeEditBubble() {
            editBubbleOverlay.style.display = 'none';
            currentEditType = null;
        }

        function saveEdit() {
            if (!currentEditType) return;
            
            if (currentEditType === 'badge') {
                const lines = document.querySelectorAll('.badge-text .edit-target');
                lines.forEach((line, index) => {
                    const input = document.getElementById(`edit-input-${index}`);
                    if (input) {
                        line.textContent = input.value;
                    }
                });
            } else if (currentEditType === 'signature') {
                const input = bubbleInputs.querySelector('input');
                document.querySelector('.signature-line').textContent = input.value;
            } else if (currentEditType === 'float') {
                const labels = document.querySelectorAll('.float-label .edit-target');
                labels.forEach((label, index) => {
                    const input = document.getElementById(`edit-input-float-${index}`);
                    if (input) label.textContent = input.value;
                });
            }

            saveData();
            closeEditBubble();
        }

        // --- Image Upload Logic ---
        let currentUploadTarget = null;
        function triggerUpload(target) {
            currentUploadTarget = target;
            document.getElementById('img-input').click();
        }
        
        document.getElementById('img-input').addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(evt) {
                    const res = evt.target.result;
                    if (currentUploadTarget === 'badge-avatar') {
                        document.getElementById('badge-display').src = res;
                        saveData();
                    } else if (currentUploadTarget === 'main-avatar') {
                        document.getElementById('main-display').src = res;
                        saveData();
                    } else if (currentUploadTarget === 'vinyl-cover') {
                        document.querySelector('#vinyl-label-art').innerHTML = `<img src="${res}">`;
                        saveData();
                    } else if (currentUploadTarget === 'contact-avatar') {
                        document.getElementById('contact-form-avatar').src = res;
                        // ËøôÈáå‰∏çË∞ÉÁî® saveData()ÔºåÂõ†‰∏∫ËÅîÁ≥ª‰∫∫Êï∞ÊçÆÊòØÂçïÁã¨‰øùÂ≠òÁöÑ
                    }
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        function applyWallpaper(url) {
            const targets = [
                document.getElementById('home-screen'),
                document.getElementById('lock-screen')
            ];
            
            targets.forEach(el => {
                if (el) {
                    if (url) {
                        el.style.backgroundImage = `url(${url})`;
                        el.style.backgroundSize = 'cover';
                        el.style.backgroundPosition = 'center';
                    } else {
                        el.style.backgroundImage = '';
                        el.style.backgroundSize = '';
                        el.style.backgroundPosition = '';
                    }
                }
            });
        }
        
        function applyIconStyle(element, url) {
            if (!element) return;
            if (url) {
                element.style.backgroundImage = `url(${url})`;
                element.style.backgroundSize = 'cover';
                element.style.backgroundPosition = 'center';
                element.style.backgroundRepeat = 'no-repeat';
                Array.from(element.children).forEach(child => {
                    if (!child.classList.contains('icon-edit-btn')) {
                        child.style.display = 'none';
                    }
                });
                element.classList.remove('vinyl-style');
            } else {
                element.style.backgroundImage = '';
                element.style.backgroundSize = '';
                element.style.backgroundPosition = '';
                element.style.backgroundRepeat = '';
                Array.from(element.children).forEach(child => {
                    if (!child.classList.contains('icon-edit-btn')) {
                        child.style.display = '';
                    }
                });
            }
        }
        
        function loadFont(url, fontName) {
            if(!url) return;
            const name = 'NetworkFont_' + new Date().getTime();
            const fontFace = new FontFace(name, `url(${url})`);
            
            fontFace.load().then(function(loadedFace) {
                document.fonts.add(loadedFace);
                document.documentElement.style.setProperty('--ios-font', `${name}, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif`);
                
                // Exclude Diary app from font change
                document.querySelectorAll('.app-item').forEach(item => {
                    const appNameEl = item.querySelector('.app-name');
                    if (appNameEl && appNameEl.textContent.trim() === 'Diary') {
                        item.style.fontFamily = '-apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif';
                    }
                });
            }).catch(e => {
                console.error('Font load error:', e);
            });
        }

        // --- Data Persistence ---

        function saveData() {
            let data = {};
            try {
                // ËØªÂèñÁé∞ÊúâÈÖçÁΩÆ‰ª•ÈÅøÂÖçË¶ÜÁõñËÆæÁΩÆÈ°µÁöÑÊï∞ÊçÆ
                data = JSON.parse(localStorage.getItem('iphone-emulator-data') || '{}');
            } catch (e) {}
            
            // ‰ªÖÊõ¥Êñ∞‰∏ªÈ°µÂèØÁºñËæëÁöÑÊï∞ÊçÆ
            const badgeLines = document.querySelectorAll('.badge-text .edit-target');
            if(badgeLines.length) data.badgeLines = Array.from(badgeLines).map(el => el.textContent);
            
            const floatLabels = document.querySelectorAll('.float-label .edit-target');
            if(floatLabels.length) data.floatLabels = Array.from(floatLabels).map(el => el.textContent);
            
            const sig = document.querySelector('.signature-line');
            if(sig) data.signature = sig.textContent;
            
            const badgeAvatar = document.getElementById('badge-display');
            if(badgeAvatar) data.badgeAvatar = badgeAvatar.src;
            
            const mainAvatar = document.getElementById('main-display');
            if(mainAvatar) data.mainAvatar = mainAvatar.src;
            
            const vinylCoverImg = document.querySelector('#vinyl-label-art img');
            if(vinylCoverImg) data.vinylCover = vinylCoverImg.src;
            else if(document.querySelector('#vinyl-label-art') && document.querySelector('#vinyl-label-art').innerHTML === '') data.vinylCover = null;
            
            localStorage.setItem('iphone-emulator-data', JSON.stringify(data));
        }

        function loadSavedData() {
            let data;
            try {
                const jsonData = localStorage.getItem('iphone-emulator-data');
                if (!jsonData) return;
                data = JSON.parse(jsonData);
            } catch (e) {
                console.error("Failed to parse saved data:", e);
                return;
            }
            if (!data) return;
            
            if(data.badgeLines) {
                const lines = document.querySelectorAll('.badge-text .edit-target');
                data.badgeLines.forEach((text, i) => { if (lines[i]) lines[i].textContent = text; });
            }
            if(data.floatLabels) {
                const labels = document.querySelectorAll('.float-label .edit-target');
                data.floatLabels.forEach((text, i) => { if (labels[i]) labels[i].textContent = text; });
            }
            if(data.signature) document.querySelector('.signature-line').textContent = data.signature;
            
            if (data.badgeAvatar) {
                document.getElementById('badge-display').src = data.badgeAvatar;
            }
            if (data.mainAvatar) {
                document.getElementById('main-display').src = data.mainAvatar;
            }
            if(data.vinylCover) {
                document.querySelector('#vinyl-label-art').innerHTML = `<img src="${data.vinylCover}">`;
            }
            
            if (data.wallpaper) {
                const urlMatch = data.wallpaper.match(/url\("?(.*?)"?\)/);
                if (urlMatch && urlMatch[1]) applyWallpaper(urlMatch[1]);
            }
            
            if (data.nightMode) {
                document.querySelector('.screen').classList.add('night-mode');
            }

            if (data.fontUrl) {
                loadFont(data.fontUrl, data.fontName);
            }
            
            if (data.dockIcons) {
                const mainIcons = document.querySelectorAll('.dock-container > div');
                data.dockIcons.forEach((bg, i) => {
                    const url = bg ? (bg.match(/url\("?(.*?)"?\)/) || [])[1] : null;
                    if (url && mainIcons[i]) applyIconStyle(mainIcons[i], url);
                });
            }
            if (data.appIcons) {
                const mainIcons = document.querySelectorAll('.desktop .app-icon');
                data.appIcons.forEach((bg, i) => {
                    const url = bg ? (bg.match(/url\("?(.*?)"?\)/) || [])[1] : null;
                    if (url && mainIcons[i]) applyIconStyle(mainIcons[i], url);
                });
            }
        }

        window.addEventListener('load', () => {
             document.body.classList.add('page-loaded');
             if (localStorage.getItem('isBrowserUnlocked') === 'true') {
                document.getElementById('lock-screen').style.display = 'none';
                const homeScreen = document.getElementById('home-screen');
                homeScreen.style.display = 'flex';
                homeScreen.style.opacity = '1';
             }
             loadSavedData();
             const data = JSON.parse(localStorage.getItem('iphone-emulator-data') || '{}');
             if (!data.wallpaper) {
                applyWallpaper('Â£ÅÁ∫∏.jpg');
                // Don't auto-save default wallpaper here to avoid overwriting if localStorage was empty for other reasons,
                // but it's fine as saveData() merges.
             }
             autoResizeEmulator();
        });

        // --- Auto Resize Logic ---
        function autoResizeEmulator() {
            const iphoneBody = document.querySelector('.iphone-body');
            if (!iphoneBody) return;

            const baseWidth = 393 + 12; 
            const baseHeight = 852 + 12; 
            const margin = 40; 

            const availableWidth = window.innerWidth - margin;
            const availableHeight = window.innerHeight - margin;

            const scaleX = availableWidth / baseWidth;
            const scaleY = availableHeight / baseHeight;

            const scale = Math.min(scaleX, scaleY, 1.2); 

            iphoneBody.style.transform = `scale(${scale})`;
        }

        window.addEventListener('resize', autoResizeEmulator);
    </script>
</body>
</html>
