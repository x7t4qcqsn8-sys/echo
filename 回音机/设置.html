<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPhone 16 Pro Emulator - Settings</title>
    <style>
        :root {
            --iphone-width: 393px;
            --iphone-height: 852px;
            --iphone-radius: 55px;
            --screen-radius: 47px;
            --island-width: 120px;
            --island-height: 36px;
            --island-radius: 16px;
            --ios-font: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
            
            /* Light & Dark Theme Variables */
            --label-green: #628364;
            --c-bg: #f2f2f7;
            --c-card-bg: #ffffff;
            --c-icon-bg: #e9e9eb;
            --c-text-primary: #000000;
            --c-text-secondary: #8a8a8e;
            --c-text-tertiary: #c7c7cc;
            --c-separator: #c6c6c8;
            --c-dock-bg: rgba(255, 255, 255, 0.45);
            --c-status-bar: #000000;
            --c-app-name: #FFFFFF;
            --c-app-name-shadow: 0 1px 2px rgba(0,0,0,0.5);
            --c-badge-bg: rgba(255, 255, 255, 0.25);
            --c-badge-border: rgba(255, 255, 255, 0.3);
            --c-badge-text: #666;
            --c-badge-icon: #000;
            --c-float-label-bg: rgba(255, 255, 255, 0.25);
            --c-float-label-text: #8a8a8e;
            --c-float-label-border: rgba(255,255,255,0.3);
            --c-switch-bg: #e9e9ea;
            --c-switch-bg-active: #34c759;
            --c-switch-knob: #fff;

            /* 动态配置变量默认值 */
            --badge-font-size: 5px;
            --badge-scroll-scale: 0.9;
            --badge-blur: 20px;
            --badge-opacity-active: 0.9;
            --badge-opacity-normal: 0.6;
            --icon-scale: 1.05;
            --icon-text-margin: -1px;
            --dock-bg-alpha: 0.45;
            --dock-blur: 25px;
            --avatar-scale: 0.833;
            --middle-offset: 25px;
            --vinyl-scale: 1.155;
            --badge-offset: 20px;

            /* 新增变量 */
            --settings-title-size: 36px;
            --settings-title-scroll-size: 34px;
            --preview-scale: 0.35;
            --app-name-size: 12px;
            --float-label-scale: 1.1;
            --vinyl-offset-x: -10px;
            --lower-icons-offset-y: -5px;
            --lower-icons-offset-x: 10px;
            --lower-icons-gap-v: 25px;
            --lower-icons-gap-h: 15px;

            /* Icon colors */
            --bg-icon: #F1F3F5;
            --gray-100: #E9ECEF;
            --gray-200: #CED4DA;
            --gray-300: #ADB5BD;
            --gray-500: #6C757D;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: var(--ios-font);
            overflow: hidden;
        }

        .iphone-body {
            width: calc(var(--iphone-width) + 12px);
            height: calc(var(--iphone-height) + 12px);
            background: #ffffff;
            border: 2px solid #d1d1d6;
            border-radius: var(--iphone-radius);
            padding: 6px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1);
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .screen {
            width: var(--iphone-width);
            height: var(--iphone-height);
            background: #FFFFFF;
            border-radius: var(--screen-radius);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .dynamic-island {
            width: var(--island-width);
            height: var(--island-height);
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border-radius: var(--island-radius);
            position: absolute;
            top: 11px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3000;
        }

        .status-bar {
            position: absolute;
            top: 0;
            width: 100%;
            height: 44px;
            padding: 0 28px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding-bottom: 6px;
            font-size: 16px;
            font-weight: 600;
            color: var(--c-status-bar);
            z-index: 2500;
            pointer-events: none;
        }

        .status-right {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .battery-container {
            display: flex;
            align-items: center;
            gap: 1.5px;
        }
        .battery-body {
            width: 24.5px;
            height: 11.5px;
            background: rgba(0,0,0,0.1);
            border: 1px solid var(--c-status-bar);
            border-radius: 4px;
            position: relative;
            padding: 1px;
            display: flex;
        }
        .battery-fill {
            height: 100%;
            width: 54%;
            background: var(--c-status-bar);
            border-radius: 1.5px;
        }
        .battery-body::after {
            content: '';
            position: absolute;
            right: -3.5px;
            width: 2px;
            height: 4px;
            background-color: var(--c-status-bar);
            border-radius: 0 1px 1px 0;
            top: 50%;
            transform: translateY(-50%);
        }

        /* 预览需要的样式 */
        .full-screen {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
        }
        .desktop {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding-top: 10px;
        }
        .upper-layout {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        .badge-widget {
            width: 165px;
            height: 105px;
            background: var(--c-badge-bg);
            backdrop-filter: blur(15px);
            background-size: cover;
            background-position: center;
            border: 1px solid var(--c-badge-border);
            border-radius: 5px;
            position: relative;
            padding: 10px;
            display: flex;
            align-items: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.04);
            margin-top: 20px;
            transform: translateY(calc(20% + var(--badge-offset)));
            z-index: 10;
            overflow: hidden;
        }
        .badge-text-scroller {
            flex-grow: 1;
            overflow-x: auto;
            overflow-y: hidden;
            height: 64px;
            display: flex;
            align-items: center;
            scrollbar-width: none;
            mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
        }
        .badge-text-scroller::-webkit-scrollbar { display: none; }
        .stitch-wrap {
            position: absolute;
            top: 6px; left: 6px; right: 6px; bottom: 6px;
            border: 1.2px dashed #d0d0d0;
            border-radius: 5px;
            pointer-events: none;
            z-index: 25;
            background: rgba(255, 255, 255, var(--badge-opacity-normal));
            backdrop-filter: blur(var(--badge-blur));
            transition: all 0.3s ease;
        }
        .badge-inner {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            z-index: 26;
            padding-left: 15px;
        }
        .badge-photo {
            width: 54px;
            height: 64px;
            background: #f5f5f7;
            border-radius: 12px;
            overflow: hidden;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .badge-photo img { width: 100%; height: 100%; object-fit: cover; }
        .badge-text {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-width: 100%;
            height: 100%;
            padding: 1px 0;
            transition: transform 0.3s ease;
            transform-origin: center center;
        }
        .badge-line {
            display: flex;
            align-items: center;
            gap: 2px;
            color: var(--c-badge-text);
            white-space: nowrap;
            font-size: 5px !important; 
            transition: font-size 0.3s ease;
        }
        .badge-line span {
            font-size: inherit; 
            display: inline-block;
            line-height: 1.2;
        }
        .badge-icon {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
            opacity: 0.8;
            color: var(--c-badge-icon);
        }
        .app-icon svg {
            width: 40px;
            height: 40px;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-width: 1.6;
        }
        .stroke-dark { stroke: var(--gray-500); }
        .stroke-medium { stroke: var(--gray-300); }
        .stroke-light { stroke: var(--gray-200); }
        .fill-dark { fill: var(--gray-500); }
        .fill-medium { fill: var(--gray-300); }
        .fill-light { fill: var(--gray-200); }
        .app-grid-2x2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px 15px;
            flex-grow: 1;
            margin-top: 25px;
        }
        .app-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 60px;
        }
        .app-icon {
            width: 60px;
            height: 60px;
            border-radius: 13px;
            background: var(--c-icon-bg) !important;
            margin-bottom: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            transform: scale(var(--icon-scale));
            transition: transform 0.2s;
            opacity: 0.6;
        }
        .app-icon.vinyl-style {
            background: linear-gradient(145deg, #f0f0f0, #e0e0e0) !important;
            border-radius: 14px;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        .vinyl-player-widget {
            width: 135px;
            height: 135px;
            background: linear-gradient(145deg, #f8f8f8, #e8e8e8);
            border-radius: 20px;
            position: relative;
            box-shadow: 
                0 8px 25px rgba(0,0,0,0.1),
                0 2px 8px rgba(0,0,0,0.06),
                inset 0 1px 0 rgba(255,255,255,0.9);
            overflow: hidden;
            margin-top: 0;
            transform: scale(var(--vinyl-scale)) translateX(var(--vinyl-offset-x));
            transform-origin: top right;
        }
        .vinyl-player-widget .vp-record {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #c8c8c8 0%, #a8a8a8 30%, #b8b8b8 50%, #a0a0a0 70%, #c0c0c0 100%);
            box-shadow: 
                0 3px 12px rgba(0,0,0,0.12),
                inset 0 0 20px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .vinyl-player-widget .vp-record::before {
            content: '';
            position: absolute;
            width: 95px;
            height: 95px;
            border-radius: 50%;
            border: 1px solid rgba(0,0,0,0.04);
        }
        .vinyl-player-widget .vp-record::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: repeating-radial-gradient(
                circle at center,
                transparent 0px,
                transparent 1.5px,
                rgba(0,0,0,0.02) 1.5px,
                rgba(0,0,0,0.02) 3px
            );
        }
        .vinyl-player-widget .vp-label {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
            box-shadow: 
                0 2px 6px rgba(0,0,0,0.08),
                inset 0 -1px 3px rgba(0,0,0,0.04);
            position: relative;
            overflow: hidden;
        }
        .vinyl-player-widget .vp-label-art {
            font-size: 22px;
            opacity: 1;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
        }
        .vinyl-player-widget .vp-label-art img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .vinyl-player-widget .vp-center-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #fff;
            border: 1.5px solid #ddd;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }
        .vinyl-player-widget .vp-arm-base {
            position: absolute;
            top: 8px;
            right: 10px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: linear-gradient(145deg, #fff, #eee);
            border: 2px solid #ccc;
            z-index: 20;
            box-shadow: 0 2px 5px rgba(0,0,0,0.12);
        }
        .vinyl-player-widget .vp-arm-base::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #bbb;
        }
        .vinyl-player-widget .vp-arm {
            position: absolute;
            top: 15px;
            right: 16px;
            width: 45px;
            height: 3px;
            background: linear-gradient(180deg, #c0c0c0, #a0a0a0);
            transform: rotate(30deg);
            transform-origin: right center;
            border-radius: 2px;
            z-index: 15;
            box-shadow: 0 2px 3px rgba(0,0,0,0.15);
        }
        .vinyl-player-widget .vp-arm::before {
            content: '';
            position: absolute;
            left: -4px;
            top: 50%;
            transform: translateY(-50%);
            width: 10px;
            height: 5px;
            background: linear-gradient(180deg, #888, #666);
            border-radius: 1.5px;
        }
        .vinyl-player-widget .vp-arm::after {
            content: '';
            position: absolute;
            left: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 3px;
            background: #555;
            border-radius: 1px;
        }
        .app-icon .letter {
            font-size: 28px;
            font-weight: 500;
            color: var(--c-text-primary);
        }
        .app-name {
            display: block;
            font-size: var(--app-name-size);
            color: var(--c-app-name);
            margin-top: -7px;
            text-align: center;
            width: 100%;
            text-shadow: var(--c-app-name-shadow);
        }
        .middle-region {
            height: 200px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-top: calc(10px + var(--middle-offset));
            gap: 10px;
        }
        .center-circle-avatar {
            width: 115px;
            height: 115px;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            overflow: hidden;
            background: #fafafa;
            z-index: 5;
            backdrop-filter: blur(10px);
            transform: scale(var(--avatar-scale)) translateY(-50px);
        }
        .center-circle-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .signature-line {
            font-size: 13px;
            color: var(--c-text-secondary);
            margin-top: -50px;
        }
        .float-label {
            position: absolute;
            background: var(--c-float-label-bg);
            backdrop-filter: blur(12px);
            padding: 4px 14px;
            border-radius: 15px;
            font-size: 10px;
            color: var(--c-float-label-text);
            white-space: nowrap;
            z-index: 20;
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            font-family: serif;
            border: 0.5px solid var(--c-float-label-border);
            transform: scale(var(--float-label-scale)) translateY(10px);
        }
        .pos-aeri { top: 5px; left: 45px; }
        .pos-green { top: 10px; right: 40px; }
        .pos-dream { bottom: 100px; left: 40px; }
        .pos-bling { bottom: 95px; right: 35px; }
        .lower-layout {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 5px;
        }
        .lower-combined-layout {
            display: flex;
            gap: 15px;
            margin-top: 0px;
            align-items: flex-start;
            justify-content: space-between;
        }
        .lower-left-apps {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--lower-icons-gap-v) var(--lower-icons-gap-h);
            transform: translate(var(--lower-icons-offset-x), var(--lower-icons-offset-y));
        }
        .app-grid-2x2 .app-item:nth-child(3),
        .app-grid-2x2 .app-item:nth-child(4) {
            margin-top: -10px;
        }
        .lower-left-apps .app-item:nth-child(1) {
            transform: translateY(5px);
        }
        .lower-left-apps .app-item:nth-child(2) {
            transform: translate(10px, 5px);
        }
        .lower-left-apps .app-item:nth-child(4) {
            transform: translateX(10px);
        }
        .lower-combined-layout .vinyl-player-widget {
            margin-top: 0;
            flex-shrink: 0;
        }
        .dock-container {
            position: absolute;
            bottom: 17px;
            left: 18px;
            right: 18px;
            height: 94px;
            background: var(--c-dock-bg);
            backdrop-filter: blur(var(--dock-blur));
            border-radius: 41px;
            display: flex;
            justify-content: space-evenly;
            align-items: center;
            z-index: 50;
            border: 0.5px solid rgba(255,255,255,0.2);
        }
        .dock-app-icon {
            width: 62px;
            height: 62px;
            background: var(--c-icon-bg) !important;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            font-weight: 500;
            color: var(--c-text-primary);
            opacity: 0.6;
        }
        .dock-app-icon svg {
            width: 36px;
            height: 36px;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-width: 1.8;
        }
        .lock-content {
            margin-top: 80px;
            text-align: center;
            display: flex;
            flex-direction: column-reverse;
        }
        .time-text { font-size: 80px; font-weight: 700; color: #000; margin-top: -15px; }
        .date-text { font-size: 20px; font-weight: 500; color: #000; }
        .quick-action {
            position: absolute;
            bottom: 50px;
            width: 50px; height: 50px;
            background: rgba(0,0,0,0.05);
            backdrop-filter: blur(20px);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px;
            color: #fff;
        }
        .quick-action svg { width: 24px; height: 24px; fill: #fff; }
        .home-bar {
            position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%);
            width: 120px; height: 5px; background: #000; border-radius: 3px; opacity: 0.2;
            pointer-events: none;
        }

        /* Settings Page Styles */
        #settings-page {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--c-bg);
            z-index: 3000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .settings-content-scroll {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 30px;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .settings-content-scroll::-webkit-scrollbar {
            display: none;
        }
        .settings-header {
            height: auto;
            padding: 50px 20px 10px;
            display: flex;
            flex-direction: column;
            background: var(--c-bg);
            flex-shrink: 0;
            z-index: 3001;
        }
        .settings-nav-bar {
            display: flex;
            align-items: center;
            color: #007aff;
            font-size: 12px;
            cursor: pointer;
            width: fit-content;
        }
        .settings-main-title {
            font-size: var(--settings-title-size);
            font-weight: 700;
            color: var(--c-text-primary);
            margin-bottom: 10px;
            padding: 0 16px;
            transition: font-size 0.3s ease;
        }
        .settings-search-bar {
            background: #e3e3e8;
            border-radius: 10px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            color: #8e8e93;
            font-size: 12px;
            margin: 0 16px 20px;
        }
        .settings-sub-page {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--c-bg);
            z-index: 3500;
            display: none;
            flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            overflow: hidden;
        }
        .settings-sub-page.active {
            transform: translateX(0);
            display: flex;
        }
        .sub-page-header {
            padding: 50px 16px 15px;
            background: var(--c-bg);
            flex-shrink: 0;
        }
        .sub-page-back {
            display: flex;
            align-items: center;
            color: #007aff;
            font-size: 12px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        .sub-page-back svg {
            width: 22px;
            height: 22px;
            margin-right: 4px;
        }
        .sub-page-title {
            font-size: 19px;
            font-weight: 700;
            color: var(--c-text-primary);
        }
        .sub-page-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px 16px 30px;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .sub-page-content::-webkit-scrollbar {
            display: none;
        }
        .sub-page-section {
            background: var(--c-card-bg);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .sub-page-item {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }
        .sub-page-item:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 16px;
            bottom: 0;
            right: 0;
            height: 0.5px;
            background: var(--c-separator);
        }
        .sub-page-item-label {
            font-size: 12px;
            color: var(--c-text-primary);
        }
        .sub-page-item-value {
            font-size: 12px;
            color: #8e8e93;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .sub-page-description {
            font-size: 13px;
            color: #8e8e93;
            padding: 8px 16px 0;
            line-height: 1.4;
        }
        .settings-search-bar svg { width: 16px; height: 16px; margin-right: 8px; fill: #8e8e93; }
        .settings-search-text { font-size: 12px; }
        .user-profile-card {
            background: var(--c-card-bg);
            border-radius: 10px;
            margin: 0 16px 20px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
        }
        .user-profile-img {
            width: 60px; height: 60px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
            background: #f0f0f0;
            cursor: pointer;
        }
        .user-profile-info {
            flex-grow: 1;
        }
        .user-profile-name {
            font-size: 20px;
            font-weight: 500;
            color: var(--c-text-primary);
            margin-bottom: 4px;
            cursor: pointer;
        }
        .user-profile-subtitle {
            font-size: 14px;
            color: #333;
        }
        .user-profile-cloud {
            font-size: 12px;
            color: #8e8e93;
            margin-top: 2px;
        }
        .settings-group {
            background: var(--c-card-bg);
            border-radius: 10px;
            margin: 0 16px 20px;
            overflow: hidden;
        }
        .settings-item {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            cursor: pointer;
            height: 48px;
            position: relative;
        }
        .settings-item:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 56px;
            bottom: 0;
            width: 100%;
            height: 0.5px;
            background: var(--c-separator);
        }
        .settings-icon-box {
            width: 28px; height: 28px;
            border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            margin-right: 12px;
            color: #fff;
            font-size: 16px;
        }
        .settings-icon-box svg { width: 18px; height: 18px; fill: currentColor; }
        .settings-label {
            flex-grow: 1;
            font-size: 12px;
            color: var(--c-text-primary);
        }
        .settings-status {
            color: #8e8e93;
            font-size: 12px;
            margin-right: 8px;
        }
        .settings-arrow {
            color: #c7c7cc;
            font-size: 16px;
            font-weight: 600;
        }
        .si-airplane { background: var(--c-text-secondary); }
        .si-wifi { background: var(--c-text-secondary); }
        .si-bluetooth { background: var(--c-text-secondary); }
        .si-mobile { background: var(--c-text-secondary); }
        .si-battery { background: var(--c-text-secondary); }
        .si-general { background: var(--c-text-secondary); }
        .si-display { background: var(--c-text-secondary); }
        .si-sound { background: var(--c-text-secondary); }
        .si-focus { background: var(--c-text-secondary); }
        .si-notifications { background: var(--c-text-secondary); }
        .si-hotspot { background: var(--c-text-secondary); }
        .si-vpn { background: var(--c-text-secondary); }
        .si-screen-time { background: var(--c-text-secondary); }
        .si-control-center { background: var(--c-text-secondary); }
        .ios-switch {
            width: 51px; height: 31px;
            background: var(--c-switch-bg);
            border-radius: 15.5px;
            position: relative;
            cursor: pointer;
            transition: 0.3s;
        }
        .ios-switch::after {
            content: '';
            position: absolute;
            top: 2px; left: 2px;
            width: 27px; height: 27px;
            background: var(--c-switch-knob);
            border-radius: 50%;
            transition: 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .ios-switch.active { background: var(--c-switch-bg-active); }
        .ios-switch.active::after { transform: translateX(20px); }
        .preview-section {
            margin-bottom: 20px;
        }
        .preview-container {
            display: flex;
            justify-content: center;
            gap: 35px;
            margin-bottom: 0;
            padding-top: 10px;
        }
        .preview-phone {
            width: 144px;
            height: 305px;
            background: #fff;
            border-radius: 19px;
            border: 3px solid #d1d1d6;
            overflow: hidden;
            position: relative;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
        }
        .preview-screen {
            width: 100%;
            height: 100%;
            background: #fff;
            position: relative;
            background-size: cover;
            background-position: center;
            overflow: hidden;
        }
        .preview-scale-wrapper {
            width: 393px;
            height: 852px;
            transform: scale(var(--preview-scale));
            transform-origin: top left;
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }
        .preview-scale-wrapper .badge-text-scroller {
            scrollbar-width: none;
        }
        .preview-phone .app-icon,
        .preview-phone .dock-app-icon {
            background-image: none !important;
            background-color: #d1d1d6 !important;
            color: transparent !important;
            box-shadow: none !important;
        }
        .preview-phone .app-name {
            display: none;
        }
        .preview-phone .vinyl-player-widget {
            background: #e5e5e5 !important;
            box-shadow: none !important;
        }
        .preview-phone .vinyl-player-widget * {
            opacity: 0.1;
        }
        .preview-label {
            display: none;
        }
        .preview-text-centered {
            text-align: center;
            font-size: 13px;
            color: #8e8e93;
            margin-top: 15px;
            width: 100%;
        }
        .preview-badge-widget,
        .preview-phone .center-circle-avatar,
        .preview-phone .float-label {
            background-image: none !important;
            background-color: #e5e5ea !important;
            box-shadow: none !important;
            backdrop-filter: none !important;
            border: 1px solid rgba(0,0,0,0.05) !important;
        }
        .section-label {
            font-size: 13px;
            color: #8e8e93;
            text-transform: uppercase;
            margin: 10px 0 8px 5px;
        }
        .font-url-input {
            width: 120px;
            padding: 5px 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
            outline: none;
        }
        .font-url-input-custom {
            border: none;
            background: transparent;
            text-align: right;
            color: #8e8e93;
            width: 150px;
            font-size: 12px;
            outline: none;
        }
        .font-url-input-custom::placeholder {
            color: #c7c7cc;
        }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .font-slider {
            width: 100px;
            height: 4px;
            -webkit-appearance: none;
            appearance: none;
            background: #ddd;
            border-radius: 2px;
            outline: none;
        }
        .font-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #fff;
            border: 2px solid #007aff;
            border-radius: 50%;
            cursor: pointer;
        }
        #font-size-value {
            font-size: 14px;
            color: #8e8e93;
            min-width: 35px;
        }
        .icon-design-section {
            padding: 15px;
        }
        .icon-section-title {
            font-size: 12px;
            color: #8e8e93;
            margin: 10px 0 8px 0;
        }
        .icon-row {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        .icon-edit-item {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .icon-preview {
            width: 48px;
            height: 48px;
            background-color: var(--bg-icon);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-size: cover;
            background-position: center;
            box-shadow: 
                -6px -6px 12px #FFFFFF,
                6px 6px 12px #D1D5DB;
            border: 1px solid rgba(255,255,255,0.6);
            font-size: 20px;
            font-weight: 500;
            color: #000;
        }
        .icon-preview.inset {
            background: linear-gradient(145deg, #e6e9ef, #ffffff);
            box-shadow: inset 1px 1px 3px rgba(0,0,0,0.03);
            border: 1px solid rgba(255,255,255,0.4);
        }
        .icon-preview svg {
            width: 60%;
            height: 60%;
            fill: none;
            stroke: #8A8A8E;
            stroke-width: 2px;
        }
        .icon-edit-btn {
            position: absolute;
            top: auto;
            bottom: -3px;
            right: -3px;
            width: 18px;
            height: 18px;
            background: #8e8e93;
            border: 1px solid #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0;
            color: transparent;
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            z-index: 10;
        }
        .icon-edit-btn::after {
            content: '';
            width: 10px;
            height: 10px;
            background-color: #fff;
            -webkit-mask: url("data:image/svg+xml,%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z'/%3E%3C/svg%3E") no-repeat center center / contain;
            mask: url("data:image/svg+xml,%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z'/%3E%3C/svg%3E") no-repeat center center / contain;
        }
        .reset-icons-btn {
            margin-top: 15px;
            background: transparent;
            border: none;
            text-align: center;
            color: #007aff;
            font-size: 16px;
            cursor: pointer;
        }
        /* Night Mode */
        .screen.night-mode {
            --c-bg: #000000;
            --c-card-bg: #1c1c1e;
            --c-icon-bg: #1c1c1e;
            --c-text-primary: #ffffff;
            --c-text-secondary: #8e8e93;
            --c-text-tertiary: #5a5a5e;
            --c-separator: #38383a;
            --c-dock-bg: rgba(30, 30, 30, 0.75);
            --c-status-bar: #ffffff;
            --c-app-name: #ffffff;
            --c-app-name-shadow: none;
            --c-badge-bg: rgba(30, 30, 30, 0.6);
            --c-badge-border: rgba(255, 255, 255, 0.1);
            --c-badge-text: #98989d;
            --c-badge-icon: #ffffff;
            --c-float-label-bg: rgba(44, 44, 46, 0.6);
            --c-float-label-text: #86c489;
            --c-float-label-border: rgba(255, 255, 255, 0.1);
            --c-switch-bg: #39393d;
        }
        .screen.night-mode {
            background-color: var(--c-bg);
            color: var(--c-text-primary);
        }
        .screen.night-mode .dynamic-island { background: #000000; }
        .screen.night-mode #settings-page, 
        .screen.night-mode .settings-sub-page,
        .screen.night-mode .settings-header,
        .screen.night-mode .sub-page-header {
            background-color: var(--c-bg);
        }
        .screen.night-mode .preview-phone {
            border-color: #38383a;
        }
        .screen.night-mode .preview-screen {
            background: #000;
        }
        .screen.night-mode .preview-phone .app-icon,
        .screen.night-mode .preview-phone .dock-app-icon {
            background-color: #38383a !important;
        }
        .screen.night-mode .preview-phone .vinyl-player-widget {
            background: #2c2c2e !important;
        }
        .screen.night-mode .preview-badge-widget,
        .screen.night-mode .preview-phone .center-circle-avatar,
        .screen.night-mode .preview-phone .float-label {
            background-color: #2c2c2e !important;
        }
        .screen.night-mode .api-action-btn:active {
            filter: brightness(1.2);
        }
    </style>
</head>
<body>

    <div class="iphone-body">
        <div class="screen">
            <div class="dynamic-island"></div>
            <div class="status-bar">
                <div class="status-left">01:20</div>
                <div class="status-right">
                    <span>5G</span>
                    <svg width="16" height="12" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M5 12.55a11 11 0 0 1 14.08 0"></path>
                        <path d="M1.42 9a16 16 0 0 1 21.16 0"></path>
                        <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>
                        <line x1="12" y1="20" x2="12.01" y2="20"></line>
                    </svg>
                    <div class="battery-container">
                        <div class="battery-body">
                            <div class="battery-fill"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings-page">
                <div class="settings-header">
                    <div class="settings-nav-bar" onclick="closeSettings()">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
                        <span>Home</span>
                    </div>
                </div>

                <div class="settings-content-scroll">
                    <div class="settings-main-title">Settings</div>
                    <div class="settings-search-bar">
                        <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                        <span class="settings-search-text">Search</span>
                    </div>

                    <div class="user-profile-card">
                        <img class="user-profile-img" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2NjYyI+PHBhdGggZD0iTTEyIDEyYzIuMjEgMCA0LTEuNzkgNC00cy0xLjc5LTQtNC00LTQgMS43OS00IDQgMS43OSA0IDQgNHptMCAyYy0yLjY3IDAtOCAxLjM0LTggNHYyaDE2di0yYzAtMi42Ni01LjMzLTQtOC00eiIvPjwvc3ZnPg==" alt="profile" onclick="triggerUpload('settings-avatar')">
                        <div class="user-profile-info">
                            <div class="user-profile-name" onclick="openEditBubble('nickname')">User</div>
                            <div class="user-profile-subtitle">Apple Account, iCloud, Media & Purchases</div>
                        </div>
                        <div class="settings-arrow">></div>
                    </div>

                    <div class="settings-group">
                        <div class="settings-item">
                            <div class="settings-icon-box si-airplane">
                                <svg viewBox="0 0 24 24"><path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/></svg>
                            </div>
                            <div class="settings-label">Airplane Mode</div>
                            <div class="ios-switch" onclick="this.classList.toggle('active')"></div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-icon-box si-wifi">
                                <svg viewBox="0 0 24 24"><path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3a4.237 4.237 0 0 0-6 0zm-4-4l2 2a7.074 7.074 0 0 1 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"/></svg>
                            </div>
                            <div class="settings-label">Wi-Fi</div>
                            <div class="settings-status">Not Connected</div>
                            <div class="settings-arrow">></div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-icon-box si-bluetooth">
                                <svg viewBox="0 0 24 24"><path d="M17.71 7.71L12 2h-1v7.59L6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 11 14.41V22h1l5.71-5.71-4.3-4.29 4.3-4.29zM13 5.83l1.88 1.88L13 9.59V5.83zm1.88 10.46L13 18.17v-3.76l1.88 1.88z"/></svg>
                            </div>
                            <div class="settings-label">Bluetooth</div>
                            <div class="settings-status">On</div>
                            <div class="settings-arrow">></div>
                        </div>
                    </div>

                    <div class="settings-group">
                        <div class="settings-item">
                            <div class="settings-icon-box si-notifications">
                                <svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/></svg>
                            </div>
                            <div class="settings-label">Notifications</div>
                            <div class="settings-arrow">></div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-icon-box si-sound">
                                <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                            </div>
                            <div class="settings-label">Sounds & Haptics</div>
                            <div class="settings-arrow">></div>
                        </div>
                    </div>

                    <div class="settings-group">
                        <div class="settings-item" onclick="openSubPage('general')">
                            <div class="settings-icon-box si-general">
                                <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22l1.92-3.32c.04-.22 0-.41-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                            </div>
                            <div class="settings-label">General</div>
                            <div class="settings-arrow">></div>
                        </div>
                        <div class="settings-item" onclick="openSubPage('display')">
                            <div class="settings-icon-box si-display">
                                <svg viewBox="0 0 24 24"><path d="M20 3H4c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h3l-1 1v2h12v-2l-1-1h3c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 13H4V5h16v11z"/></svg>
                            </div>
                            <div class="settings-label">Display & Brightness</div>
                            <div class="settings-arrow">></div>
                        </div>
                        <div class="settings-item" onclick="openSubPage('homescreen')">
                            <div class="settings-icon-box si-hotspot">
                                <svg viewBox="0 0 24 24"><path d="M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"/></svg>
                            </div>
                            <div class="settings-label">Lock Screen & Home Screen</div>
                            <div class="settings-arrow">></div>
                        </div>
                    </div>
                </div>
            
                <!-- Sub Pages -->
                <div id="sub-page-general" class="settings-sub-page">
                    <div class="sub-page-header">
                        <div class="sub-page-back" onclick="closeSubPage()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
                            Settings
                        </div>
                        <div class="sub-page-title">General</div>
                    </div>
                    <div class="sub-page-content">
                        <p class="section-label">API配置</p>
                        <div id="api-config-list-container" class="sub-page-section"></div>

                        <p class="section-label">思考模型配置 (Thinking Model)</p>
                        <div class="sub-page-section">
                            <div class="sub-page-item" onclick="openSubPage('thinking-model')">
                                <div class="sub-page-item-label">配置思考模型</div>
                                <div class="sub-page-item-value">></div>
                            </div>
                        </div>

                        <p class="section-label">通用设置</p>
                         <div class="sub-page-section">
                            <div class="sub-page-item">
                                <div class="sub-page-item-label">记忆条数</div>
                                <div class="sub-page-item-value">
                                    <input type="number" id="global-memory-count" value="10" min="1" max="100" class="font-url-input-custom" onchange="saveGlobalSettings()">
                                </div>
                            </div>
                            <div class="sub-page-item">
                                <div class="sub-page-item-label">API 温度 (Temperature)</div>
                                <div class="sub-page-item-value">
                                    <input type="number" id="global-temperature" value="0.7" step="0.1" min="0" max="2" class="font-url-input-custom" onchange="saveGlobalSettings()">
                                </div>
                            </div>
                        </div>

                        <p class="section-label" style="margin-top: 30px;">数据管理</p>
                        <div class="sub-page-section">
                            <div class="sub-page-item" onclick="backupData()">
                                <div class="sub-page-item-label" style="color:#007aff;">备份所有设置</div>
                                <div class="sub-page-item-value">></div>
                            </div>
                            <div class="sub-page-item" onclick="triggerRestore()">
                                <div class="sub-page-item-label" style="color:#007aff;">从备份恢复</div>
                                <div class="sub-page-item-value">></div>
                            </div>
                        </div>
                        
                        <p class="section-label">重置</p>
                        <div class="sub-page-section">
                            <div class="sub-page-item" onclick="resetAllSettings()">
                                <div class="sub-page-item-label" style="color:#ff3b30;">重置所有设置</div>
                            </div>
                        </div>
                        <p class="sub-page-description">此操作将清除所有用户数据和个性化设置，将模拟器恢复到初始状态。此操作无法撤销。</p>
                    </div>
                </div>

                <div id="sub-page-api-edit" class="settings-sub-page">
                    <div class="sub-page-header">
                        <div class="sub-page-back" onclick="closeSubPage()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
                            General
                        </div>
                        <div id="api-edit-page-title" class="sub-page-title">API 配置</div>
                    </div>
                    <div class="sub-page-content">
                        <input type="hidden" id="api-config-id">
                        <p class="section-label">配置信息</p>
                        <div class="sub-page-section">
                            <div class="sub-page-item">
                                <div class="sub-page-item-label">名称</div>
                                <div class="sub-page-item-value">
                                    <input type="text" id="api-config-name" placeholder="例如：小克" class="font-url-input-custom">
                                </div>
                            </div>
                            <div class="sub-page-item">
                                <div class="sub-page-item-label">API 地址 (url)</div>
                                <div class="sub-page-item-value">
                                    <input type="text" id="api-config-url" placeholder="例如：https://api.example.com" class="font-url-input-custom">
                                </div>
                            </div>
                            <div class="sub-page-item">
                                <div class="sub-page-item-label">API 密钥</div>
                                <div class="sub-page-item-value">
                                    <input type="password" id="api-config-key" placeholder="sk-..." class="font-url-input-custom">
                                </div>
                            </div>
                            <div class="sub-page-item">
                                <div class="sub-page-item-label">模型名称</div>
                                <div class="sub-page-item-value">
                                    <input type="text" id="api-config-model" placeholder="例如：gpt-4" class="font-url-input-custom">
                                </div>
                            </div>
                        </div>

                        <div class="sub-page-section">
                            <div class="sub-page-item" onclick="saveApiConfig()">
                                <div class="sub-page-item-label" style="color:#007aff; text-align: center; width: 100%;">保存</div>
                            </div>
                        </div>

                        <div id="api-edit-actions-section" style="display: none;">
                            <p class="section-label">操作</p>
                            <div class="sub-page-section">
                                <div class="sub-page-item" onclick="setDefaultApiConfig()">
                                    <div class="sub-page-item-label" style="color:#007aff;">设为默认</div>
                                </div>
                            </div>
                            <div class="sub-page-section">
                                <div class="sub-page-item" onclick="deleteApiConfig()">
                                    <div class="sub-page-item-label" style="color:#ff3b30;">删除</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="sub-page-thinking-model" class="settings-sub-page">
                    <div class="sub-page-header">
                        <div class="sub-page-back" onclick="closeSubPage()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
                            General
                        </div>
                        <div class="sub-page-title">Thinking Model</div>
                    </div>
                    <div class="sub-page-content">
                        <p class="section-label">模型信息</p>
                        <div class="sub-page-section">
                            <div class="sub-page-item">
                                <div class="sub-page-item-label">模型名称</div>
                                <div class="sub-page-item-value">
                                    <input type="text" id="thinking-model-name" placeholder="例如：deepseek-reasoner" class="font-url-input-custom">
                                </div>
                            </div>
                            <div class="sub-page-item">
                                <div class="sub-page-item-label">API 地址</div>
                                <div class="sub-page-item-value">
                                    <input type="text" id="thinking-endpoint" placeholder="https://api.example.com/v1" class="font-url-input-custom">
                                </div>
                            </div>
                            <div class="sub-page-item">
                                <div class="sub-page-item-label">API 密钥</div>
                                <div class="sub-page-item-value">
                                    <input type="password" id="thinking-api-key" placeholder="sk-..." class="font-url-input-custom">
                                </div>
                            </div>
                        </div>
                        <div class="sub-page-section">
                            <div class="sub-page-item" onclick="saveThinkingModelConfig()">
                                <div class="sub-page-item-label" style="color:#007aff; text-align: center; width: 100%;">保存</div>
                            </div>
                        </div>
                        <p class="sub-page-description">思考模型用于在生成最终回复前进行深度思考。如果配置，AI 将在回复前显示思考过程（需模型支持 reasoning_content）。</p>
                    </div>
                </div>

                <div id="sub-page-display" class="settings-sub-page">
                    <div class="sub-page-header">
                        <div class="sub-page-back" onclick="closeSubPage()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
                            Settings
                        </div>
                        <div class="sub-page-title">Display & Brightness</div>
                    </div>
                    <div class="sub-page-content">
                        <p class="section-label">显示模式</p>
                        <div class="sub-page-section">
                            <div class="sub-page-item">
                                <div class="sub-page-item-label">夜间模式</div>
                                <div class="sub-page-item-value">
                                    <div class="ios-switch" id="night-mode-switch" onclick="toggleNightMode()"></div>
                                </div>
                            </div>
                        </div>

                        <p class="section-label">全局字体</p>
                        <div class="sub-page-section">
                            <div class="sub-page-item" onclick="triggerFontUpload()">
                                <div class="sub-page-item-label">本地字体</div>
                                <div class="sub-page-item-value" style="color: #8e8e93;">从文件中导入 ></div>
                            </div>
                            <div class="sub-page-item">
                                <div class="sub-page-item-label">网络字体</div>
                                <div class="sub-page-item-value">
                                    <input type="text" id="font-url-input" placeholder="支持 TTF, OTF, WOFF" class="font-url-input-custom" onchange="loadFontFromUrl()">
                                </div>
                            </div>
                            <div class="sub-page-item">
                                <div class="sub-page-item-label">字体状态</div>
                                <div class="sub-page-item-value" id="font-load-status" style="color: #8e8e93;">未加载</div>
                            </div>
                            <div class="sub-page-item">
                                <div class="sub-page-item-label">当前字体</div>
                                <div class="sub-page-item-value" id="current-font-name">系统默认</div>
                            </div>
                            <div class="sub-page-item" onclick="resetFont()">
                                <div class="sub-page-item-label" style="color:#007aff;">恢复默认字体</div>
                                <div class="sub-page-item-value"></div>
                            </div>
                            <div class="sub-page-item">
                                <div class="sub-page-item-label">字体大小</div>
                                <div class="sub-page-item-value slider-container">
                                    <input type="range" id="font-size-slider" min="10" max="20" value="14" class="font-slider" oninput="updateFontSize()">
                                    <span id="font-size-value">14px</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                <div id="sub-page-homescreen" class="settings-sub-page">
                    <div class="sub-page-header">
                        <div class="sub-page-back" onclick="closeSubPage()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
                            Settings
                        </div>
                        <div class="sub-page-title">Beautification Center</div>
                    </div>
                    <div class="sub-page-content" id="homescreen-settings-content">
                        <div class="preview-container">
                            <div class="preview-phone" id="lock-preview">
                                <div class="preview-screen" id="lock-preview-screen">
                                    <div class="preview-scale-wrapper">
                                        <div class="dynamic-island"></div>
                                        <div class="status-bar" style="padding:0 28px;">
                                            <div class="status-left">01:20</div>
                                            <div class="status-right">
                                                <span>5G</span>
                                                <div class="battery-container"><div class="battery-body"><div class="battery-fill"></div></div></div>
                                            </div>
                                        </div>
                                        <div class="full-screen" style="display:flex; flex-direction:column; align-items:center;">
                                            <div class="lock-content" style="margin-top:80px; text-align:center; display:flex; flex-direction:column-reverse;">
                                                <div class="time-text preview-time-text">01:20</div>
                                                <div class="date-text preview-date-text">Monday, Jan 12</div>
                                            </div>
                                            <div class="quick-action" style="left:40px;">🔦</div>
                                            <div class="quick-action" style="right:40px;">📷</div>
                                            <div class="home-bar"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="preview-phone" id="home-preview">
                                <div class="preview-screen" id="home-preview-screen">
                                    <div class="preview-scale-wrapper">
                                        <div class="dynamic-island"></div>
                                        <div class="status-bar">
                                            <div class="status-left">01:20</div>
                                            <div class="status-right">
                                                <span>5G</span>
                                                <div class="battery-container"><div class="battery-body"><div class="battery-fill"></div></div></div>
                                            </div>
                                        </div>
                                        <div style="padding: 44px 20px 0; display:flex; flex-direction:column; height:100%;">
                                            <div class="desktop">
                                                <div class="upper-layout">
                                                    <div class="badge-widget preview-badge-widget">
                                                        <div class="stitch-wrap"></div>
                                                        <div class="badge-inner">
                                                            <div class="badge-photo"><img class="preview-badge-display" src="" alt=""></div>
                                                            <div class="badge-text-scroller">
                                                                <div class="badge-text">
                                                                   <div class="badge-line"><span class="preview-badge-text-0"></span></div> 
                                                                   <div class="badge-line"><span class="preview-badge-text-1"></span></div> 
                                                                   <div class="badge-line"><span class="preview-badge-text-2"></span></div> 
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="app-grid-2x2">
                                                        <div class="app-item"><div class="app-icon preview-app-icon-0"><span class="letter">T</span></div><div class="app-name">tomato</div></div>
                                                        <div class="app-item"><div class="app-icon preview-app-icon-1"><span class="letter">T</span></div><div class="app-name">taooo</div></div>
                                                        <div class="app-item"><div class="app-icon preview-app-icon-2"><span class="letter">W</span></div><div class="app-name">-w-</div></div>
                                                        <div class="app-item"><div class="app-icon preview-app-icon-3"><span class="letter">K</span></div><div class="app-name">keke</div></div>
                                                    </div>
                                                </div>

                                                <div class="middle-region">
                                                    <div class="center-circle-avatar">
                                                        <img src="" alt="avatar">
                                                    </div>
                                                    <div class="signature-line preview-signature"></div>
                                                    <div class="float-label pos-aeri preview-float-0"></div>
                                                    <div class="float-label pos-green preview-float-1"></div>
                                                    <div class="float-label pos-bling preview-float-2"></div>
                                                    <div class="float-label pos-dream preview-float-3"></div>
                                                </div>

                                                <div class="lower-combined-layout">
                                                    <div class="lower-left-apps">
                                                        <div class="app-item"><div class="app-icon preview-app-icon-4"></div><div class="app-name">Music</div></div>
                                                        <div class="app-item"><div class="app-icon preview-app-icon-5"></div><div class="app-name">Photos</div></div>
                                                        <div class="app-item"><div class="app-icon preview-app-icon-6"></div><div class="app-name">App Store</div></div>
                                                        <div class="app-item"><div class="app-icon preview-app-icon-7"></div><div class="app-name">wink</div></div>
                                                    </div>
                                                    <div class="vinyl-player-widget">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="dock-container">
                                                <div class="dock-app-icon preview-dock-icon-0">C</div>
                                                <div class="dock-app-icon preview-dock-icon-1">C</div>
                                                <div class="dock-app-icon preview-dock-icon-2">G</div>
                                                <div class="dock-app-icon settings-icon preview-dock-icon-3">⚙</div>
                                            </div>
                                            <div class="home-bar" style="position:absolute; bottom:8px; left:50%; transform:translateX(-50%);"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="preview-text-centered">实时预览</div>

                        <p class="section-label">壁纸</p>
                        <div class="sub-page-section">
                            <div class="sub-page-item" onclick="triggerWallpaperUpload()">
                                <div class="sub-page-item-label" style="color:#007aff;">选择新壁纸</div>
                                <div class="sub-page-item-value"></div>
                            </div>
                        </div>
                        
                        <p class="section-label">图标设计</p>
                        <div class="sub-page-section icon-design-section">
                            <p class="icon-section-title">桌面图标</p>
                            <div class="icon-row">
                                <div class="icon-edit-item"><div class="icon-preview" id="edit-icon-0"><svg viewBox="0 0 24 24"><rect x="2" y="5" width="20" height="14" rx="4" class="stroke-dark" /><path d="M10 8.5L15.5 12L10 15.5V8.5Z" class="fill-dark" stroke="none"/></svg></div><div class="icon-edit-btn" onclick="triggerIconUpload(0)">✏️</div></div>
                                <div class="icon-edit-item"><div class="icon-preview" id="edit-icon-1"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="5" ry="5" class="stroke-medium" /><circle cx="12" cy="12" r="4" class="stroke-dark" stroke-width="2" /><circle cx="17.5" cy="6.5" r="1.2" class="fill-dark" stroke="none" /></svg></div><div class="icon-edit-btn" onclick="triggerIconUpload(1)">✏️</div></div>
                                <div class="icon-edit-item"><div class="icon-preview" id="edit-icon-2"><svg viewBox="0 0 24 24"><polyline points="4 7 8 18 12 8 16 18 20 7" class="stroke-medium" stroke-linejoin="round" /></svg></div><div class="icon-edit-btn" onclick="triggerIconUpload(2)">✏️</div></div>
                                <div class="icon-edit-item"><div class="icon-preview" id="edit-icon-3"><svg viewBox="0 0 24 24"><line x1="7" y1="7" x2="17" y2="17" class="stroke-dark" stroke-width="2.2" /><line x1="17" y1="7" x2="7" y2="17" class="stroke-dark" stroke-width="2.2" /></svg></div><div class="icon-edit-btn" onclick="triggerIconUpload(3)">✏️</div></div>
                            </div>
                            <div class="icon-row">
                                <div class="icon-edit-item"><div class="icon-preview" id="edit-icon-4"><svg viewBox="0 0 24 24"><rect x="5" y="4" width="14" height="16" rx="2" class="stroke-medium" /><path d="M7 3V7 M11 3V7 M15 3V7" class="stroke-dark" /><path d="M7.5 12C8.5 11 9.5 13 10.5 12" class="stroke-light" /><path d="M16 18l4-4 2 2-4 4h-2v-2z" fill="#F1F3F5" class="stroke-dark" /></svg></div><div class="icon-edit-btn" onclick="triggerIconUpload(4)">✏️</div></div>
                                <div class="icon-edit-item"><div class="icon-preview" id="edit-icon-5"><svg viewBox="0 0 24 24"><path d="M8 6C5.5 6 3.5 8 3.5 10.5C3.5 14 7 17 11 19" class="stroke-medium" fill="none" /><path d="M11 6C11.5 6 12 6.1 12.5 6.3" class="stroke-medium" /><path d="M16 6C18.5 6 20.5 8 20.5 10.5C20.5 14 17 17 13 19" class="stroke-medium" fill="none" /><path d="M13 6C12.5 6 12 6.1 11.5 6.3" class="stroke-medium" /><path d="M12 19V19.5" class="stroke-medium" /></svg></div><div class="icon-edit-btn" onclick="triggerIconUpload(5)">✏️</div></div>
                                <div class="icon-edit-item"><div class="icon-preview" id="edit-icon-6"><svg viewBox="0 0 24 24"><rect x="5" y="4" width="14" height="16" rx="2.5" class="stroke-medium" /><line x1="10" y1="4" x2="10" y2="20" class="stroke-medium" /><path d="M5 9 Q 7.5 10 10 9" class="stroke-light" fill="none" /><path d="M5 12 Q 7.5 13 10 12" class="stroke-light" fill="none" /><path d="M5 15 Q 7.5 16 10 15" class="stroke-light" fill="none" /><path d="M7.5 4 V 20" class="stroke-light" /><rect x="13" y="8" width="3" height="1.5" rx="0.5" class="fill-medium" stroke="none" opacity="0.6" /></svg></div><div class="icon-edit-btn" onclick="triggerIconUpload(6)">✏️</div></div>
                                <div class="icon-edit-item"><div class="icon-preview" id="edit-icon-7"><svg viewBox="0 0 24 24"><path d="M15 5C18.3137 5 21 7.23858 21 10C21 11.9079 20.0916 13.606 18.6833 14.4532L19 17L16.2 16.1C15.8152 16.1654 15.4137 16.2 15 16.2" class="stroke-light" /><path d="M9 19.8C5.68629 19.8 3 17.5614 3 14.8C3 12.0386 5.68629 9.8 9 9.8C12.3137 9.8 15 12.0386 15 14.8C15 17.5614 12.3137 19.8 9 19.8Z" fill="#F1F3F5" stroke="none"/><path d="M9 19.8C5.68629 19.8 3 17.5614 3 14.8C3 12.0386 5.68629 9.8 9 9.8C12.3137 9.8 15 12.0386 15 14.8C15 15.2137 14.9585 15.6152 14.8 16L15.6 18.5L13.1118 18.068C12.0156 19.1411 10.5841 19.8 9 19.8Z" class="stroke-light" /><circle cx="7" cy="14.8" r="0.8" class="fill-dark" /><circle cx="9" cy="14.8" r="0.8" class="fill-dark" /><circle cx="11" cy="14.8" r="0.8" class="fill-dark" /></svg></div><div class="icon-edit-btn" onclick="triggerIconUpload(7)">✏️</div></div>
                            </div>
                            
                            <p class="icon-section-title">Dock栏</p>
                            <div class="icon-row dock-icon-row">
                                <div class="icon-edit-item"><div class="icon-preview dock-preview" id="edit-dock-0"><svg viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" class="stroke-dark" /></svg></div><div class="icon-edit-btn" onclick="triggerDockIconUpload(0)">✏️</div></div>
                                <div class="icon-edit-item"><div class="icon-preview dock-preview" id="edit-dock-1"><svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" class="stroke-medium" /><circle cx="12" cy="7" r="4" class="stroke-dark" /></svg></div><div class="icon-edit-btn" onclick="triggerDockIconUpload(1)">✏️</div></div>
                                <div class="icon-edit-item"><div class="icon-preview dock-preview" id="edit-dock-2"><svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" class="stroke-medium" /><line x1="8" y1="9" x2="16" y2="9" class="stroke-light" /><line x1="8" y1="13" x2="13" y2="13" class="stroke-light" /></svg></div><div class="icon-edit-btn" onclick="triggerDockIconUpload(2)">✏️</div></div>
                                <div class="icon-edit-item"><div class="icon-preview dock-preview inset" id="edit-dock-3"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3" class="stroke-dark" /><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" class="stroke-medium" stroke-width="1.2" /><circle cx="12" cy="12" r="1.5" class="fill-dark" stroke="none" /></svg></div><div class="icon-edit-btn" onclick="triggerDockIconUpload(3)">✏️</div></div>
                            </div>
                            
                            <div class="reset-icons-btn" onclick="resetToDefaultTheme()">保存默认主题</div>
                        </div>
                    </div>
                </div>

                <div id="sub-page-faceid" class="settings-sub-page">
                    <div class="sub-page-header">
                        <div class="sub-page-back" onclick="closeSubPage()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
                            Settings
                        </div>
                        <div class="sub-page-title">Face ID & Passcode</div>
                    </div>
                    <div class="sub-page-content">
                        <div class="sub-page-section">
                            <div class="sub-page-item"><div class="sub-page-item-label">iPhone Unlock</div><div class="sub-page-item-value"><div class="ios-switch active"></div></div></div>
                            <div class="sub-page-item"><div class="sub-page-item-label">iTunes & App Store</div><div class="sub-page-item-value"><div class="ios-switch active"></div></div></div>
                            <div class="sub-page-item"><div class="sub-page-item-label">Wallet & Apple Pay</div><div class="sub-page-item-value"><div class="ios-switch active"></div></div></div>
                            <div class="sub-page-item"><div class="sub-page-item-label">Password AutoFill</div><div class="sub-page-item-value"><div class="ios-switch active"></div></div></div>
                        </div>
                        <div class="sub-page-section">
                            <div class="sub-page-item"><div class="sub-page-item-label">Set Up an Alternate Appearance</div><div class="sub-page-item-value">></div></div>
                            <div class="sub-page-item"><div class="sub-page-item-label">Reset Face ID</div><div class="sub-page-item-value">></div></div>
                        </div>
                        <div class="sub-page-section">
                            <div class="sub-page-item"><div class="sub-page-item-label">Change Passcode</div><div class="sub-page-item-value">></div></div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Hidden Inputs -->
            <input type="file" id="img-input" hidden accept="image/*">
            <input type="file" id="font-input" hidden accept=".ttf,.otf,.woff,.woff2">
            <input type="file" id="icon-input" hidden accept="image/*">
            <input type="file" id="wallpaper-input" hidden accept="image/*" onchange="handleWallpaperUpload(this)">
            <input type="file" id="restore-input" hidden accept=".json" onchange="handleRestore(this)">
            
            <!-- Edit Bubble Overlay (for nickname editing) -->
            <div id="edit-bubble-overlay" class="edit-bubble-overlay" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.1); backdrop-filter:blur(10px); z-index:5000; justify-content:center; align-items:center;">
                <div class="edit-bubble" style="width:280px; background:rgba(255,255,255,0.9); backdrop-filter:blur(20px); border-radius:20px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.1); text-align:center;">
                    <h3 id="bubble-title" style="margin-bottom:15px; font-size:17px;">文案</h3>
                    <div id="bubble-inputs"></div>
                    <div class="edit-btns" style="display:flex; gap:10px; margin-top:10px;">
                        <button class="btn-cancel" onclick="closeEditBubble()" style="flex:1; padding:10px; border:none; border-radius:10px; cursor:pointer; font-weight:600; background:#e9e9eb; color:#ff3b30;">取消</button>
                        <button class="btn-confirm" onclick="saveEdit()" style="flex:1; padding:10px; border:none; border-radius:10px; cursor:pointer; font-weight:600; background:#e9e9eb; color:#007aff;">确定</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Time Update
        function updateTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const timeString = `${hours}:${minutes}`;
            
            document.querySelectorAll('.time-text').forEach(el => el.textContent = timeString);
            document.querySelectorAll('.status-left').forEach(el => el.textContent = timeString);

            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const dateString = `${days[now.getDay()]}, ${months[now.getMonth()]} ${now.getDate()}`;
            
            document.querySelectorAll('.date-text').forEach(el => el.textContent = dateString);
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Navigation
        function closeSettings() {
            window.location.href = 'index.html';
        }

        function openSubPage(pageId) {
            const page = document.getElementById('sub-page-' + pageId);
            if(page) {
                page.style.display = 'flex';
                setTimeout(() => page.classList.add('active'), 10);
            }
        }

        function closeSubPage() {
            const activePages = Array.from(document.querySelectorAll('.settings-sub-page.active'));
            if (activePages.length > 0) {
                const pageToClose = activePages[activePages.length - 1];
                pageToClose.classList.remove('active');
                setTimeout(() => {
                    pageToClose.style.display = 'none';
                    if (pageToClose.id === 'sub-page-api-edit') {
                        apiConfigManager.renderApiConfigList();
                    }
                }, 300);
            }
        }

        // Edit Bubble Logic (Only for nickname in settings)
        const editBubbleOverlay = document.getElementById('edit-bubble-overlay');
        const bubbleTitle = document.getElementById('bubble-title');
        const bubbleInputs = document.getElementById('bubble-inputs');
        let currentEditType = null;

        function openEditBubble(type) {
            currentEditType = type;
            bubbleInputs.innerHTML = '';
            editBubbleOverlay.style.display = 'flex';
            
            if (type === 'nickname') {
                bubbleTitle.textContent = '编辑昵称';
                const input = document.createElement('input');
                input.value = document.querySelector('.user-profile-name').textContent;
                input.style.width = '100%';
                input.style.padding = '10px';
                input.style.marginBottom = '10px';
                input.style.border = '1px solid #ddd';
                input.style.borderRadius = '10px';
                input.style.outline = 'none';
                input.style.fontSize = '14px';
                bubbleInputs.appendChild(input);
            }
        }

        function closeEditBubble() {
            editBubbleOverlay.style.display = 'none';
            currentEditType = null;
        }

        function saveEdit() {
            if (!currentEditType) return;
            if (currentEditType === 'nickname') {
                const input = bubbleInputs.querySelector('input');
                document.querySelector('.user-profile-name').textContent = input.value;
            }
            saveData();
            closeEditBubble();
        }

        // Upload Logic
        let currentUploadTarget = null;
        function triggerUpload(target) {
            currentUploadTarget = target;
            document.getElementById('img-input').click();
        }
        
        document.getElementById('img-input').addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(evt) {
                    const res = evt.target.result;
                    if (currentUploadTarget === 'settings-avatar') {
                        document.querySelector('.user-profile-img').src = res;
                    }
                    saveData();
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        function triggerWallpaperUpload() {
            document.getElementById('wallpaper-input').click();
        }
        
        function handleWallpaperUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    applyWallpaper(e.target.result);
                    saveData();
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function applyWallpaper(url) {
            const targets = [
                document.getElementById('lock-preview-screen'),
                document.getElementById('home-preview-screen')
            ];
            targets.forEach(el => {
                if (el) {
                    if (url) {
                        el.style.backgroundImage = `url(${url})`;
                        el.style.backgroundSize = 'cover';
                        el.style.backgroundPosition = 'center';
                    } else {
                        el.style.backgroundImage = '';
                    }
                }
            });
        }

        // Night Mode
        function toggleNightMode() {
            const screen = document.querySelector('.screen');
            screen.classList.toggle('night-mode');
            const switchBtn = document.getElementById('night-mode-switch');
            if (screen.classList.contains('night-mode')) {
                switchBtn.classList.add('active');
            } else {
                switchBtn.classList.remove('active');
            }
            saveData();
        }

        // Font Logic
        function triggerFontUpload() {
            document.getElementById('font-input').click();
        }
        document.getElementById('font-input').addEventListener('change', function(e) {
             if (e.target.files && e.target.files[0]) {
                 const file = e.target.files[0];
                 const reader = new FileReader();
                 reader.onload = function(evt) {
                     const fontFace = new FontFace('CustomFont', evt.target.result);
                     fontFace.load().then(function(loadedFace) {
                         document.fonts.add(loadedFace);
                         document.documentElement.style.setProperty('--ios-font', 'CustomFont, sans-serif');
                         document.getElementById('current-font-name').textContent = file.name;
                         saveData();
                     });
                 };
                 reader.readAsArrayBuffer(file);
             }
        });
        
        function loadFontFromUrl() {
            const url = document.getElementById('font-url-input').value.trim();
            const statusEl = document.getElementById('font-load-status');
            const currentFontEl = document.getElementById('current-font-name');

            if(url) {
                statusEl.textContent = '加载中...';
                statusEl.style.color = '#8e8e93';
                const fontName = 'NetworkFont_' + new Date().getTime();
                const fontFace = new FontFace(fontName, `url(${url})`);
                fontFace.load().then(function(loadedFace) {
                    document.fonts.add(loadedFace);
                    document.documentElement.style.setProperty('--ios-font', `${fontName}, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif`);
                    let name = url.split('/').pop().split('?')[0];
                    name = name.replace(/\.(ttf|otf|woff|woff2)$/i, '');
                    currentFontEl.textContent = name || 'Web Font';
                    statusEl.textContent = '加载成功';
                    statusEl.style.color = '#34c759';
                    saveData();
                }).catch(e => {
                    console.error('Font load error:', e);
                    statusEl.textContent = '加载失败';
                    statusEl.style.color = '#ff3b30';
                    alert('字体加载失败，请检查URL或网络连接。');
                });
            }
        }
        
        function resetFont() {
            document.documentElement.style.removeProperty('--ios-font');
            document.getElementById('current-font-name').textContent = '系统默认';
            document.getElementById('font-load-status').textContent = '未加载';
            document.getElementById('font-load-status').style.color = '#8e8e93';
            document.getElementById('font-url-input').value = '';
            saveData();
        }
        
        function updateFontSize() {
            const val = document.getElementById('font-size-slider').value;
            document.getElementById('font-size-value').textContent = val + 'px';
        }

        // Icon Logic
        let currentIconIndex = -1;
        let isDockIcon = false;
        
        function triggerIconUpload(index) {
            currentIconIndex = index;
            isDockIcon = false;
            document.getElementById('icon-input').click();
        }
        
        function triggerDockIconUpload(index) {
            currentIconIndex = index;
            isDockIcon = true;
            document.getElementById('icon-input').click();
        }
        
        document.getElementById('icon-input').addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(evt) {
                    const imageUrl = evt.target.result;
                    let editPreviewIcon, homePreviewIcon;
                    if (isDockIcon) {
                        editPreviewIcon = document.getElementById(`edit-dock-${currentIconIndex}`);
                        homePreviewIcon = document.querySelector(`.preview-dock-icon-${currentIconIndex}`);
                    } else {
                        editPreviewIcon = document.getElementById(`edit-icon-${currentIconIndex}`);
                        homePreviewIcon = document.querySelector(`.preview-app-icon-${currentIconIndex}`);
                    }
                    applyIconStyle(editPreviewIcon, imageUrl);
                    applyIconStyle(homePreviewIcon, imageUrl);
                    saveData();
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });
        
        function applyIconStyle(element, url) {
            if (!element) return;
            if (url) {
                element.style.backgroundImage = `url(${url})`;
                element.style.backgroundSize = 'cover';
                element.style.backgroundPosition = 'center';
                element.style.backgroundRepeat = 'no-repeat';
                Array.from(element.children).forEach(child => {
                    if (!child.classList.contains('icon-edit-btn')) {
                        child.style.display = 'none';
                    }
                });
                element.classList.remove('vinyl-style');
            } else {
                element.style.backgroundImage = '';
                element.style.backgroundSize = '';
                element.style.backgroundPosition = '';
                element.style.backgroundRepeat = '';
                Array.from(element.children).forEach(child => {
                    if (!child.classList.contains('icon-edit-btn')) {
                        child.style.display = '';
                    }
                });
            }
        }

        function resetToDefaultTheme() {
            if (confirm('您确定要恢复所有设置为初始主题吗？此操作将清除所有个性化设置且无法撤销。')) {
                applyWallpaper('壁纸.jpg');
                const defaultAvatarSrc = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2NjYyI+PHBhdGggZD0iTTEyIDEyYzIuMjEgMCA0LTEuNzkgNC00cy0xLjc5LTQtNC00LTQgMS43OS00IDQgMS43OSA0IDQgNHptMCAyYy0yLjY3IDAtOCAxLjM0LTggNHYyaDE2di0yYzAtMi42Ni01LjMzLTQtOC00eiIvPjwvc3ZnPg==';
                document.querySelector('.user-profile-img').src = defaultAvatarSrc;
                const previewBadgeDisplay = document.querySelector('.preview-badge-display');
                if (previewBadgeDisplay) previewBadgeDisplay.src = defaultAvatarSrc;

                // Reset Icons
                for(let i=0; i<8; i++) {
                    applyIconStyle(document.getElementById(`edit-icon-${i}`), null);
                    applyIconStyle(document.querySelector(`.preview-app-icon-${i}`), null);
                }
                for(let i=0; i<4; i++) {
                    applyIconStyle(document.getElementById(`edit-dock-${i}`), null);
                    applyIconStyle(document.querySelector(`.preview-dock-icon-${i}`), null);
                }

                // Reset Text
                const defaultBadgeLines = ['ㅎㅇ…🤍🩶', '♡⁺ʚ 행복 ', 'ɞ⁺♡₊˚.𓏴ᦒᦒ𓏴 ₊˚'];
                const pLines = document.querySelectorAll('[class^="preview-badge-text-"]');
                defaultBadgeLines.forEach((text, i) => { if (pLines[i]) pLines[i].textContent = text; });
                document.querySelector('.user-profile-name').textContent = 'User';

                resetFont();
                const screen = document.querySelector('.screen');
                if (screen.classList.contains('night-mode')) {
                    screen.classList.remove('night-mode');
                }
                const nightModeSwitch = document.getElementById('night-mode-switch');
                if (nightModeSwitch.classList.contains('active')) {
                    nightModeSwitch.classList.remove('active');
                }

                localStorage.removeItem('iphone-emulator-data');
                alert('主题已成功恢复到初始状态！');
            }
        }

        // Data Persistence
        function backupData() {
            const themeData = localStorage.getItem('iphone-emulator-data');
            const apiConfigs = localStorage.getItem(API_CONFIG_STORAGE_KEY);
            const backupObject = {
                themeData: themeData ? JSON.parse(themeData) : {},
                apiConfigs: apiConfigs ? JSON.parse(apiConfigs) : []
            };
            const jsonString = JSON.stringify(backupObject, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const now = new Date();
            const timestamp = now.getFullYear() +
                ('0' + (now.getMonth() + 1)).slice(-2) +
                ('0' + now.getDate()).slice(-2) + '-' +
                ('0' + now.getHours()).slice(-2) +
                ('0' + now.getMinutes()).slice(-2) +
                ('0' + now.getSeconds()).slice(-2);
            const filename = `iphone-backup-${timestamp}.json`;
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(a.href);
            alert('备份文件已开始下载！');
        }

        function triggerRestore() {
            document.getElementById('restore-input').click();
        }

        function handleRestore(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backupData = JSON.parse(e.target.result);
                        if (backupData && backupData.themeData && backupData.apiConfigs) {
                            localStorage.setItem('iphone-emulator-data', JSON.stringify(backupData.themeData));
                            localStorage.setItem(API_CONFIG_STORAGE_KEY, JSON.stringify(backupData.apiConfigs));
                            alert('恢复成功！界面将自动刷新以应用设置。');
                            setTimeout(() => {
                                location.reload();
                            }, 1000);
                        } else {
                            alert('恢复失败：备份文件格式不正确。');
                        }
                    } catch (error) {
                        console.error('Restore error:', error);
                        alert('恢复失败：无法解析备份文件。');
                    }
                };
                reader.readAsText(file);
            }
            input.value = '';
        }

        function resetAllSettings() {
            if (confirm('您确定要重置所有设置吗？此操作将清除所有API配置和个性化设置，且无法撤销。')) {
                localStorage.removeItem('iphone-emulator-data');
                localStorage.removeItem(API_CONFIG_STORAGE_KEY);
                alert('所有设置已重置。界面将自动刷新。');
                setTimeout(() => {
                    location.reload();
                }, 1000);
            }
        }

        function saveData() {
            // We need to read existing data to preserve fields not present in settings page (like mainAvatar, badgeAvatar, etc if they are not editable here but previewed)
            // Actually, settings page edits settingsAvatar, nickname, wallpaper, font, icons.
            // It does NOT edit badgeLines, floatLabels, signature directly (except nickname).
            // Wait, the original code had edits for badgeLines etc in the home screen.
            // In settings page, we only have preview.
            // So we should be careful not to overwrite missing fields with null.
            
            let existingData = {};
            try {
                existingData = JSON.parse(localStorage.getItem('iphone-emulator-data')) || {};
            } catch(e) {}

            const data = {
                ...existingData,
                nickname: document.querySelector('.user-profile-name').textContent,
                settingsAvatar: document.querySelector('.user-profile-img').src,
                // wallpaper is updated via applyWallpaper which calls saveData, so we read from preview
                wallpaper: document.getElementById('home-preview-screen').style.backgroundImage,
                nightMode: document.querySelector('.screen').classList.contains('night-mode'),
                // icons
                dockIcons: Array.from(document.querySelectorAll('.dock-container > div')).map(el => el.style.backgroundImage),
                appIcons: Array.from(document.querySelectorAll('.desktop .app-icon')).map(el => el.style.backgroundImage),
                fontUrl: document.getElementById('font-url-input').value,
                fontName: document.getElementById('current-font-name').textContent,
            };
            localStorage.setItem('iphone-emulator-data', JSON.stringify(data));
        }

        function loadSavedData() {
            let data;
            try {
                const jsonData = localStorage.getItem('iphone-emulator-data');
                if (!jsonData) return;
                data = JSON.parse(jsonData);
            } catch (e) {
                return;
            }
            if (!data) return;
            
            // Load preview data
            if(data.badgeLines) {
                const pLines = document.querySelectorAll('[class^="preview-badge-text-"]');
                data.badgeLines.forEach((text, i) => { if (pLines[i]) pLines[i].textContent = text; });
            }
            if(data.floatLabels) {
                const pLabels = document.querySelectorAll('[class^="preview-float-"]');
                data.floatLabels.forEach((text, i) => { if (pLabels[i]) pLabels[i].textContent = text; });
            }
            if(data.signature) {
                const pSig = document.querySelector('.preview-signature');
                if(pSig) pSig.textContent = data.signature;
            }
            if(data.nickname) document.querySelector('.user-profile-name').textContent = data.nickname;
            
            if (data.badgeAvatar) {
                const p = document.querySelector('.preview-badge-display');
                if(p) p.src = data.badgeAvatar;
            }
            if (data.mainAvatar) {
                const p = document.querySelector('.preview-phone .center-circle-avatar img');
                if(p) p.src = data.mainAvatar;
            }
            if (data.settingsAvatar) {
                document.querySelector('.user-profile-img').src = data.settingsAvatar;
            }
            
            if (data.wallpaper) {
                const urlMatch = data.wallpaper.match(/url\("?(.*?)"?\)/);
                if (urlMatch && urlMatch[1]) applyWallpaper(urlMatch[1]);
            }
            
            if (data.nightMode) {
                document.querySelector('.screen').classList.add('night-mode');
                document.getElementById('night-mode-switch').classList.add('active');
            }

            if (data.fontUrl) {
                document.getElementById('font-url-input').value = data.fontUrl;
                loadFontFromUrl();
            }
            
            if (data.dockIcons) {
                const mainIcons = document.querySelectorAll('.dock-container > div');
                data.dockIcons.forEach((bg, i) => {
                    const url = bg ? (bg.match(/url\("?(.*?)"?\)/) || [])[1] : null;
                    if (url) {
                        applyIconStyle(document.getElementById(`edit-dock-${i}`), url);
                        applyIconStyle(document.querySelector(`.preview-dock-icon-${i}`), url);
                    }
                });
            }
            if (data.appIcons) {
                const mainIcons = document.querySelectorAll('.desktop .app-icon');
                data.appIcons.forEach((bg, i) => {
                    const url = bg ? (bg.match(/url\("?(.*?)"?\)/) || [])[1] : null;
                    if (url) {
                        applyIconStyle(document.getElementById(`edit-icon-${i}`), url);
                        applyIconStyle(document.querySelector(`.preview-app-icon-${i}`), url);
                    }
                });
            }
        }

        // API Config Manager
        const API_CONFIG_STORAGE_KEY = 'api-configs';
        const GLOBAL_SETTINGS_KEY = 'api-global-settings';
        const THINKING_MODEL_KEY = 'thinking-model-settings';

        const apiConfigManager = {
            getConfigs: function() {
                const configsJSON = localStorage.getItem(API_CONFIG_STORAGE_KEY);
                if (!configsJSON) return [];
                try { return JSON.parse(configsJSON); } catch (e) { return []; }
            },
            saveConfigs: function(configs) {
                localStorage.setItem(API_CONFIG_STORAGE_KEY, JSON.stringify(configs));
            },
            renderApiConfigList: function() {
                const configs = this.getConfigs();
                const container = document.getElementById('api-config-list-container');
                container.innerHTML = '';
                if (configs.length > 0) {
                    configs.forEach(config => {
                        const item = document.createElement('div');
                        item.className = 'sub-page-item';
                        item.setAttribute('onclick', `openApiEditPage('${config.id}')`);
                        let statusIndicator = '';
                        if (config.isDefault) {
                            statusIndicator = '<span style="color: #34c759; font-size: 12px; margin-left: 8px;">默认</span>';
                        }
                        item.innerHTML = `<div class="sub-page-item-label">${config.name}${statusIndicator}</div><div class="settings-arrow">></div>`;
                        container.appendChild(item);
                    });
                }
                const addItem = document.createElement('div');
                addItem.className = 'sub-page-item';
                addItem.setAttribute('onclick', 'openApiEditPage()');
                addItem.innerHTML = `<div class="sub-page-item-label" style="color:#007aff;">添加新配置</div><div class="settings-arrow">></div>`;
                container.appendChild(addItem);
            }
        };

        function openApiEditPage(id) {
            const title = document.getElementById('api-edit-page-title');
            const idInput = document.getElementById('api-config-id');
            const nameInput = document.getElementById('api-config-name');
            const urlInput = document.getElementById('api-config-url');
            const keyInput = document.getElementById('api-config-key');
            const modelInput = document.getElementById('api-config-model');
            const actionsSection = document.getElementById('api-edit-actions-section');

            if (id) {
                title.textContent = '编辑 API';
                const configs = apiConfigManager.getConfigs();
                const config = configs.find(c => c.id === id);
                if (config) {
                    idInput.value = config.id;
                    nameInput.value = config.name;
                    urlInput.value = config.url;
                    keyInput.value = config.key;
                    modelInput.value = config.model || '';
                    actionsSection.style.display = 'block';
                }
            } else {
                title.textContent = '添加 API';
                idInput.value = '';
                nameInput.value = '';
                urlInput.value = '';
                keyInput.value = '';
                modelInput.value = '';
                actionsSection.style.display = 'none';
            }
            openSubPage('api-edit');
        }

        function saveApiConfig() {
            const id = document.getElementById('api-config-id').value;
            const name = document.getElementById('api-config-name').value.trim();
            const url = document.getElementById('api-config-url').value.trim();
            const key = document.getElementById('api-config-key').value.trim();
            const model = document.getElementById('api-config-model').value.trim();

            if (!name || !url) {
                alert('名称和 API 地址不能为空');
                return;
            }

            let configs = apiConfigManager.getConfigs();
            if (id) {
                const index = configs.findIndex(c => c.id === id);
                if (index > -1) {
                    configs[index] = { ...configs[index], name, url, key, model };
                }
            } else {
                const newConfig = {
                    id: 'api_' + Date.now(),
                    name,
                    url,
                    key,
                    model,
                    isDefault: false
                };
                if (configs.length === 0) {
                    newConfig.isDefault = true;
                }
                configs.push(newConfig);
            }
            apiConfigManager.saveConfigs(configs);
            closeSubPage();
        }
        
        function deleteApiConfig() {
            const id = document.getElementById('api-config-id').value;
            if (!id || !confirm('确定要删除此 API 配置吗？')) return;
            let configs = apiConfigManager.getConfigs();
            const configToDelete = configs.find(c => c.id === id);
            configs = configs.filter(c => c.id !== id);
            if (configToDelete && configToDelete.isDefault && configs.length > 0) {
                configs[0].isDefault = true;
            }
            apiConfigManager.saveConfigs(configs);
            closeSubPage();
        }
        
        function setDefaultApiConfig() {
            const id = document.getElementById('api-config-id').value;
            if (!id) return;
            let configs = apiConfigManager.getConfigs();
            configs.forEach(c => { c.isDefault = (c.id === id); });
            apiConfigManager.saveConfigs(configs);
            closeSubPage();
        }

        function saveGlobalSettings() {
            const memoryCount = document.getElementById('global-memory-count').value;
            const temperature = document.getElementById('global-temperature').value;
            try {
                let settings = JSON.parse(localStorage.getItem(GLOBAL_SETTINGS_KEY)) || {};
                settings.memoryCount = parseInt(memoryCount) || 10;
                settings.temperature = parseFloat(temperature) || 0.7;
                localStorage.setItem(GLOBAL_SETTINGS_KEY, JSON.stringify(settings));
            } catch (e) {}
        }

        function loadGlobalSettings() {
            try {
                const settings = JSON.parse(localStorage.getItem(GLOBAL_SETTINGS_KEY));
                if (settings) {
                    if (settings.memoryCount) document.getElementById('global-memory-count').value = settings.memoryCount;
                    if (settings.temperature !== undefined) document.getElementById('global-temperature').value = settings.temperature;
                }
            } catch (e) {}
        }

        function saveThinkingModelConfig() {
            const name = document.getElementById('thinking-model-name').value.trim();
            const endpoint = document.getElementById('thinking-endpoint').value.trim();
            const key = document.getElementById('thinking-api-key').value.trim();

            const settings = {
                thinking_model_name: name,
                thinking_endpoint: endpoint,
                thinking_api_key: key
            };
            localStorage.setItem(THINKING_MODEL_KEY, JSON.stringify(settings));
            alert('思考模型配置已保存');
            closeSubPage();
        }

        function loadThinkingModelConfig() {
            try {
                const settings = JSON.parse(localStorage.getItem(THINKING_MODEL_KEY));
                if (settings) {
                    document.getElementById('thinking-model-name').value = settings.thinking_model_name || '';
                    document.getElementById('thinking-endpoint').value = settings.thinking_endpoint || '';
                    document.getElementById('thinking-api-key').value = settings.thinking_api_key || '';
                }
            } catch (e) {}
        }

        function autoResizeEmulator() {
            const iphoneBody = document.querySelector('.iphone-body');
            if (!iphoneBody) return;
            const baseWidth = 393 + 12;
            const baseHeight = 852 + 12;
            const margin = 40;
            const availableWidth = window.innerWidth - margin;
            const availableHeight = window.innerHeight - margin;
            const scaleX = availableWidth / baseWidth;
            const scaleY = availableHeight / baseHeight;
            const scale = Math.min(scaleX, scaleY, 1.2); 
            iphoneBody.style.transform = `scale(${scale})`;
        }

        window.addEventListener('resize', autoResizeEmulator);
        window.addEventListener('load', () => {
             document.body.classList.add('page-loaded');
             loadSavedData();
             loadGlobalSettings();
             loadThinkingModelConfig();
             apiConfigManager.renderApiConfigList();
             autoResizeEmulator();
        });
    </script>
</body>
</html>
